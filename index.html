<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Special GAME 🌟</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }
        .mobile-button {
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .no-zoom {
            /* 讓在手機上操作時不會因為點擊或滑動而縮放頁面 */
            touch-action: pan-x pan-y;
        }
        /* 針對滑動拼圖的過渡效果 */
        .puzzle-piece {
            transition: transform 0.2s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const BirthdayGameApp = () => {
            const [currentPoints, setCurrentPoints] = useState(0);
            const [currentPage, setCurrentPage] = useState('home');
            const [gameResults, setGameResults] = useState({});
            const [gameState, setGameState] = useState('ready');

            const games = [
                { id: 'guess-number', name: '1A2B猜數字', points: 3, difficulty: '簡單', emoji: '🔢' },
                { id: 'memory-card', name: '翻牌連連看', points: 3, difficulty: '中等', emoji: '🎴' },
                { id: 'jigsaw-puzzle', name: '滑動拼圖', points: 8, difficulty: '困難', emoji: '🧩' },
                { id: 'candy-crush', name: '糖果消消樂', points: 2, difficulty: '簡單', emoji: '🍭' }
            ];
            const completeGame = (gameId, points) => {
                setCurrentPoints(prev => prev + points);
                setGameResults(prev => ({
                    ...prev,
                    [gameId]: (prev[gameId] || 0) + 1
                }));
            };

            // 滑動拼圖遊戲 (Sliding Puzzle with Image)
            const JigsawPuzzleGame = () => {
                // 預設的圖片 URL - 請務必修改這裡為您在 GitHub 上傳的圖片連結！
                // 範例：'https://Avis0930.github.io/my-surprise-game/my_surprise_image.jpg'
                const defaultImageUrl = 'https://Avis0930.github.io/my-surprise-game/puzzle_jiwoo.jpg'; // <--- **請務必修改這裡！**
                const [currentPuzzleImageUrl, setCurrentPuzzleImageUrl] = useState(defaultImageUrl);
                const [inputImageUrl, setInputImageUrl] = useState(''); // 用於使用者輸入的 URL

                const [tiles, setTiles] = useState([]);
                const [moves, setMoves] = useState(0);
                const [gameOver, setGameOver] = useState(false);
                const [loadingImage, setLoadingImage] = useState(true);
                const [error, setError] = useState(null);

                const [solvedTileOrder, setSolvedTileOrder] = useState([]);

                useEffect(() => {
                    initializeImagePuzzle(currentPuzzleImageUrl);
                }, [currentPuzzleImageUrl]); // 當圖片 URL 改變時重新初始化

                // 載入並切割圖片
                const initializeImagePuzzle = (url) => {
                    setLoadingImage(true);
                    setError(null);
                    setMoves(0); // 重置步數
                    setGameOver(false); // 重置遊戲狀態

                    const img = new Image();
                    img.crossOrigin = 'Anonymous'; // 嘗試解決 CORS 問題
                    img.src = url;

                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const pieceSize = 100;
                        const boardSize = 3;

                        canvas.width = pieceSize * boardSize;
                        canvas.height = pieceSize * boardSize;

                        const aspectRatio = img.width / img.height;
                        let drawWidth = canvas.width;
                        let drawHeight = canvas.height;
                        let startX = 0;
                        let startY = 0;

                        if (img.width > img.height) {
                            drawHeight = canvas.width / aspectRatio;
                            startY = (canvas.height - drawHeight) / 2;
                        } else {
                            drawWidth = canvas.height * aspectRatio;
                            startX = (canvas.width - drawWidth) / 2;
                        }

                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, startX, startY, drawWidth, drawHeight);

                        const generatedTiles = [];
                        for (let i = 0; i < boardSize * boardSize; i++) {
                            const row = Math.floor(i / boardSize);
                            const col = i % boardSize;
                            const x = col * pieceSize;
                            const y = row * pieceSize;

                            const pieceCanvas = document.createElement('canvas');
                            pieceCanvas.width = pieceSize;
                            pieceCanvas.height = pieceSize;
                            const pieceCtx = pieceCanvas.getContext('2d');
                            pieceCtx.drawImage(canvas, x, y, pieceSize, pieceSize, 0, 0, pieceSize, pieceSize);

                            generatedTiles.push({
                                id: i,
                                dataUrl: pieceCanvas.toDataURL('image/png')
                            });
                        }

                        // 將最後一塊設為空白
                        generatedTiles[generatedTiles.length - 1].dataUrl = '';

                        setSolvedTileOrder(generatedTiles.map(t => t.id));

                        let shuffledTiles = [...generatedTiles.map(t => ({...t}))];
                        do {
                            const imageTiles = shuffledTiles.slice(0, -1);
                            for (let i = imageTiles.length - 1; i > 0; i--) {
                                const j = Math.floor(Math.random() * (i + 1));
                                [imageTiles[i], imageTiles[j]] = [imageTiles[j], imageTiles[i]];
                            }
                            shuffledTiles = [...imageTiles, shuffledTiles[shuffledTiles.length - 1]];

                        } while (!isSolvable(shuffledTiles.map(t => t.id), boardSize) || isSolved(shuffledTiles.map(t => t.id)));

                        setTiles(shuffledTiles);
                        setMoves(0);
                        setGameOver(false);
                        setLoadingImage(false);
                    };

                    img.onerror = () => {
                        console.error('圖片載入失敗或CORS錯誤:', url); // 在控制台打印錯誤
                        setError('圖片載入失敗！請檢查URL或CORS設定。');
                        setLoadingImage(false);
                        // 可以考慮這裡清空拼圖或顯示預設錯誤圖片
                        setTiles([]);
                        setGameOver(true); // 設置為遊戲結束狀態，禁止操作
                    };
                };

                const isSolvable = (currentTileIds, boardSize) => {
                    const flatTiles = currentTileIds.filter(id => id !== solvedTileOrder[solvedTileOrder.length - 1]);
                    let inversions = 0;
                    for (let i = 0; i < flatTiles.length - 1; i++) {
                        for (let j = i + 1; j < flatTiles.length; j++) {
                            if (flatTiles[i] > flatTiles[j]) {
                                inversions++;
                            }
                        }
                    }
                    return inversions % 2 === 0;
                };

                const isSolved = (currentTileIds) => {
                    if (currentTileIds.length === 0) return false; // 避免空陣列導致錯誤判斷
                    for (let i = 0; i < solvedTileOrder.length; i++) {
                        if (currentTileIds[i] !== solvedTileOrder[i]) {
                            return false;
                        }
                    }
                    return true;
                };

                const handleTileClick = (index) => {
                    if (gameOver || loadingImage || error || tiles.length === 0) return;

                    const blankIndex = tiles.findIndex(t => t.dataUrl === '');

                    const row = Math.floor(index / 3);
                    const col = index % 3;
                    const blankRow = Math.floor(blankIndex / 3);
                    const blankCol = blankIndex % 3;

                    const isAdjacent =
                        (Math.abs(row - blankRow) === 1 && col === blankCol) ||
                        (Math.abs(col - blankCol) === 1 && row === blankRow);

                    if (isAdjacent) {
                        const newTiles = [...tiles];
                        [newTiles[index], newTiles[blankIndex]] = [newTiles[blankIndex], newTiles[index]];
                        setTiles(newTiles);
                        setMoves(moves + 1);

                        const currentTileIds = newTiles.map(t => t.id);
                        if (isSolved(currentTileIds)) {
                            setGameOver(true);
                            setTimeout(() => {
                                completeGame('jigsaw-puzzle', 8);
                                setCurrentPage('success-puzzle');
                            }, 500);
                        }
                    }
                };

                const handleUrlInputChange = (e) => {
                    setInputImageUrl(e.target.value);
                };

                const handleLoadCustomImage = () => {
                    if (inputImageUrl.trim() !== '') {
                        setCurrentPuzzleImageUrl(inputImageUrl.trim());
                    } else {
                        alert('請輸入有效的圖片 URL！');
                    }
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-300 via-indigo-400 to-blue-400 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-indigo-500 to-blue-600 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🧩 滑動拼圖 (圖片)</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        點擊移動圖片到正確順序！✨
                                    </p>
                                    <p className="text-center text-xs text-white/80 mt-1">
                                        步數: {moves}
                                    </p>
                                </div>
                                <div className="p-4">
                                    <div className="space-y-4">
                                        {/* URL 輸入框 */}
                                        <div className="bg-white rounded-lg p-3 shadow-inner border border-gray-300">
                                            <input
                                                type="text"
                                                placeholder="輸入圖片 URL (例如: https://example.com/image.jpg)"
                                                value={inputImageUrl}
                                                onChange={handleUrlInputChange}
                                                className="w-full p-2 border border-gray-300 rounded-md text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-300"
                                            />
                                            <button
                                                onClick={handleLoadCustomImage}
                                                className="w-full mt-2 bg-blue-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-600 transition-colors"
                                            >
                                                載入自訂圖片
                                            </button>
                                        </div>

                                        {loadingImage && (
                                            <div className="text-center text-gray-700 font-bold text-lg animate-pulse">
                                                載入圖片中，請稍候...
                                            </div>
                                        )}
                                        {error && (
                                            <div className="text-center text-red-600 font-bold text-lg p-2 bg-red-100 rounded-lg border border-red-300">
                                                錯誤: {error}
                                                <button
                                                    onClick={() => initializeImagePuzzle(defaultImageUrl)}
                                                    className="mt-2 bg-purple-500 text-white px-3 py-1 rounded-full text-sm hover:bg-purple-600"
                                                >
                                                    使用預設圖片
                                                </button>
                                            </div>
                                        )}
                                        {!loadingImage && !error && tiles.length > 0 && (
                                            <>
                                                {/* 參考圖片 */}
                                                <div className="bg-gradient-to-b from-gray-100 to-gray-200 rounded-2xl p-4 border-4 border-gray-300">
                                                    <div className="text-center text-sm font-bold text-gray-700 mb-3">🎯 參考圖片</div>
                                                    <div className="flex justify-center">
                                                        <img src={currentPuzzleImageUrl} alt="Reference" className="w-32 h-32 object-cover rounded-lg border-2 border-white shadow-md" />
                                                    </div>
                                                </div>

                                                {/* 拼圖區域 */}
                                                <div className="grid grid-cols-3 gap-2 p-4 bg-gradient-to-b from-blue-100 to-purple-100 rounded-2xl border-4 border-purple-300">
                                                    {tiles.map((tile, index) => (
                                                        <button
                                                            key={index}
                                                            onClick={() => handleTileClick(index)}
                                                            className={`
                                                                aspect-square rounded-lg flex items-center justify-center text-3xl font-black transition-transform duration-200 ease-out shadow-md overflow-hidden
                                                                ${tile.dataUrl === ''
                                                                    ? 'bg-gray-200 cursor-default'
                                                                    : 'bg-white text-purple-700 hover:scale-105 active:scale-95 cursor-pointer border-2 border-orange-400'
                                                                }
                                                                ${gameOver && tile.dataUrl === '' ? 'hidden' : ''}
                                                            `}
                                                            disabled={gameOver}
                                                        >
                                                            {tile.dataUrl !== '' ? (
                                                                <img src={tile.dataUrl} alt={`puzzle-piece-${tile.id}`} className="w-full h-full object-cover" />
                                                            ) : (
                                                                ''
                                                            )}
                                                        </button>
                                                    ))}
                                                </div>

                                                {gameOver && (
                                                    <div className="text-center text-green-600 font-bold text-lg mt-4 animate-bounce">
                                                        🎉 恭喜完成！獲得8點！
                                                    </div>
                                                )}
                                            </>
                                        )}

                                        <div className="text-center">
                                            <div className="text-sm text-purple-700 font-semibold mb-2">
                                                💡 操作說明：
                                            </div>
                                            <div className="text-xs text-purple-600 bg-purple-50 rounded-lg p-2">
                                                點擊與空白格相鄰的圖片方塊來移動它，直到圖片按參考圖的順序排列！
                                            </div>
                                            <button
                                                onClick={() => initializeImagePuzzle(currentPuzzleImageUrl)} // 點擊重新開始時使用當前圖片 URL
                                                className="w-full mt-3 bg-gradient-to-r from-blue-400 to-purple-500 text-white px-6 py-3 rounded-full font-black shadow-lg border-2 border-white"
                                            >
                                                重新開始 🔄
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                                >
                                    回到首頁 🏠
                                </button>
                            </div>
                        </div>
                    );
                };

            // 第一包的抽卡機制
            const addPoints = () => {
                setCurrentPoints(p => p + 10);
                setGameState('ready');
            };

            const drawCard = () => {
                if (currentPoints < 5 || gameState !== 'ready') return;
                setCurrentPoints(p => p - 5);
                setGameState('drawing');

                setTimeout(() => {
                    setGameState('result');
                }, 2000);
            };

            const resetGame = () => {
                setGameState('ready');
            };

            // 首頁
            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-cyan-300 via-purple-400 to-pink-400 p-4 no-zoom">
                    <div className="max-w-sm mx-auto">
                        <div className="text-center mb-6">
                            <div className="bg-white/90 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-4 border-white">
                                <h1 className="text-2xl sm:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500 mb-2">
                                    Special GAME
                                </h1>
                                <p className="text-purple-700 font-semibold text-sm">完成遊戲獲得點數，集滿5點抽驚喜卡片！</p>
                                <div className="flex justify-center space-x-2 mt-3">
                                    <span className="text-2xl">💖</span>
                                    <span className="text-2xl">🌈</span>
                                    <span className="text-2xl">✨</span>
                                </div>
                            </div>
                        </div>

                        {/* 控制按鈕 */}
                        <div className="fixed top-4 left-4 space-y-2 z-10">
                            <button onClick={addPoints} className="bg-red-600 text-white px-4 py-2 rounded font-bold">
                                +10點
                            </button>
                            <button onClick={resetGame} className="bg-gray-600 text-white px-4 py-2 rounded font-bold">
                                重置抽卡
                            </button>
                        </div>

                        {/* 點數顯示 */}
                        <div className="mb-6 bg-gradient-to-r from-yellow-300 to-orange-300 border-4 border-white shadow-xl rounded-2xl p-6 text-center">
                            <div className="text-2xl font-black text-white mb-2 drop-shadow-lg">
                                ⭐ 點數: {currentPoints} ⭐
                            </div>
                            <div className="text-base font-bold text-purple-800 bg-white/80 rounded-full px-4 py-1">
                                {Math.floor(currentPoints / 5)} 次抽卡機會 🎴
                            </div>
                        </div>

                        {/* 抽卡區域 */}
                        <div className="bg-gradient-to-r from-yellow-300 via-pink-300 to-purple-300 border-4 border-white rounded-2xl p-6 mb-6">
                            <h3 className="font-black text-xl mb-4 text-white text-center">🎁 驚喜卡片 🎁</h3>

                            <div className="text-center">
                                {/* READY 狀態 */}
                                {gameState === 'ready' && (
                                    <div>
                                        {currentPoints >= 5 ? (
                                            <button
                                                onClick={drawCard}
                                                className="w-full bg-cyan-500 text-white px-6 py-4 rounded-full text-lg font-black hover:bg-cyan-600"
                                            >
                                                🎴 抽卡片！(-5點) ✨
                                            </button>
                                        ) : (
                                            <div className="bg-white/90 rounded-full px-4 py-3">
                                                <p className="text-purple-700 font-bold">還需要 {5 - currentPoints} 點才能抽卡 ✨</p>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* DRAWING 狀態 */}
                                {gameState === 'drawing' && (
                                    <div className="space-y-4">
                                        <div className="text-6xl animate-spin">🎴</div>
                                        <div className="text-white font-bold text-xl animate-pulse">抽卡中...</div>
                                    </div>
                                )}

                                {/* RESULT 狀態 */}
                                {gameState === 'result' && (
                                    <div className="space-y-4">
                                        <div className="bg-gradient-to-r from-yellow-400 to-yellow-600 p-6 rounded-3xl border-4 border-white">
                                            <div className="text-4xl mb-3 animate-bounce">🥇</div>
                                            <div className="bg-white/90 rounded-2xl p-4 mb-4">
                                                <div className="text-8xl mb-2">💖</div>
                                                <div className="text-xl font-black text-purple-700">PRINCESS</div>
                                            </div>
                                            <div className="text-white text-lg font-bold">超級大獎</div>
                                        </div>

                                        <button
                                            onClick={resetGame}
                                            className="w-full bg-purple-500 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-600"
                                        >
                                            繼續遊戲 💫
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* 遊戲列表 */}
                        <div className="space-y-4">
                            {games.map((game, index) => {
                                const gradients = [
                                    'from-pink-400 to-rose-400',
                                    'from-cyan-400 to-blue-400',
                                    'from-purple-400 to-violet-400',
                                    'from-green-400 to-emerald-400'
                                ];
                                return (
                                    <div key={game.id} className={`bg-gradient-to-r ${gradients[index]} border-4 border-white shadow-xl rounded-2xl`}>
                                        <div className="p-4">
                                            <div className="flex justify-between items-center">
                                                <div className="flex-1">
                                                    <h3 className="font-black text-lg text-white drop-shadow-lg">
                                                        {game.emoji} {game.name}
                                                    </h3>
                                                    <p className="text-sm text-white/90 font-semibold">
                                                        {game.difficulty} | {game.points}點 ⭐
                                                    </p>
                                                    {gameResults[game.id] && (
                                                        <p className="text-sm text-yellow-200 font-bold">
                                                            🎉 完成 {gameResults[game.id]} 次
                                                        </p>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => setCurrentPage(game.id)}
                                                    className="mobile-button bg-white text-purple-700 px-4 py-2 rounded-full font-black hover:bg-yellow-300 transition-all shadow-lg text-sm"
                                                >
                                                    START! 💫
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
            // 猜數字遊戲
            const GuessNumberGame = () => {
                const [targetNumber, setTargetNumber] = useState('');
                const [guess, setGuess] = useState('');
                const [history, setHistory] = useState([]);
                const [attempts, setAttempts] = useState(0);
                const [gameOver, setGameOver] = useState(false);
                useEffect(() => {
                    const digits = [];
                    while (digits.length < 3) {
                        const digit = Math.floor(Math.random() * 10).toString();
                        if (!digits.includes(digit)) {
                            digits.push(digit);
                        }
                    }
                    setTargetNumber(digits.join(''));
                }, []);
                const checkGuess = () => {
                    if (guess.length !== 3 || new Set(guess).size !== 3) {
                        alert('請輸入3位不重複數字！');
                        return;
                    }

                    let a = 0, b = 0;
                    for (let i = 0; i < 3; i++) {
                        if (guess[i] === targetNumber[i]) {
                            a++;
                        } else if (targetNumber.includes(guess[i])) {
                            b++;
                        }
                    }

                    const result = `${guess} - ${a}A${b}B`;
                    setHistory([result, ...history]);
                    setAttempts(attempts + 1);

                    if (a === 3) {
                        completeGame('guess-number', 3);
                        setCurrentPage('success-number');
                        return;
                    } else if (attempts + 1 >= 10) {
                        setGameOver(true);
                    }

                    setGuess('');
                };

                const resetNumberGame = () => {
                    setGameOver(false);
                    setHistory([]);
                    setGuess('');
                    setAttempts(0);
                    const digits = [];
                    while (digits.length < 3) {
                        const digit = Math.floor(Math.random() * 10).toString();
                        if (!digits.includes(digit)) {
                            digits.push(digit);
                        }
                    }
                    setTargetNumber(digits.join(''));
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-cyan-400 via-purple-500 to-pink-500 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-blue-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🔢 數字遊戲</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        猜出3位不重複數字！A=位置和數字都對，B=數字對但位置錯 ✨
                                    </p>
                                    <p className="text-center text-xs text-white/80 mt-1">
                                        剩餘機會: {10 - attempts} 次
                                    </p>
                                </div>
                                <div className="p-6">
                                    {!gameOver ? (
                                        <div className="space-y-4">
                                            <div className="space-y-3">
                                                <input
                                                    type="tel"
                                                    value={guess}
                                                    onChange={(e) => setGuess(e.target.value.replace(/\D/g, '').slice(0, 3))}
                                                    placeholder="輸入3位數字"
                                                    className="w-full p-4 border-4 border-purple-300 rounded-full text-center text-xl font-bold focus:border-pink-400 focus:outline-none bg-white text-gray-800"
                                                    maxLength={3}
                                                />
                                                <button
                                                    onClick={checkGuess}
                                                    className="w-full bg-gradient-to-r from-cyan-400 to-blue-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-2 border-white"
                                                >
                                                    猜測! 💫
                                                </button>
                                            </div>

                                            <div className="max-h-48 overflow-y-auto space-y-2">
                                                {history.map((result, index) => (
                                                    <div key={index} className="p-3 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full text-center font-bold text-purple-700 border-2 border-purple-200">
                                                        {result}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">😅 遊戲結束</div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                答案是: {targetNumber}
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">❌ 遊戲失敗！未獲得點數</div>
                                            <button
                                                onClick={resetNumberGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                再挑戰一次! 💪
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                回到首頁 🏠
                            </button>
                        </div>
                    </div>
                );
            };

            // 翻牌連連看遊戲
            const MemoryCardGame = () => {
                const [cards, setCards] = useState([]);
                const [flippedCards, setFlippedCards] = useState([]);
                const [matchedCards, setMatchedCards] = useState([]);
                const [gameOver, setGameOver] = useState(false);
                const [timeLeft, setTimeLeft] = useState(60);
                const [timerActive, setTimerActive] = useState(false);

                const emojis = ['💖', '🌈', '✨', '🌟', '💫', '🎉', '🎈', '🦄'];
                useEffect(() => {
                    initializeGame();
                }, []);
                useEffect(() => {
                    let interval = null;
                    if (timerActive && timeLeft > 0 && !gameOver) {
                        interval = setInterval(() => {
                            setTimeLeft(timeLeft => {
                                if (timeLeft <= 1) {
                                    setGameOver(true);
                                    setTimerActive(false);
                                    return 0;
                                }
                                return timeLeft - 1;
                            });
                        }, 1000);
                    }
                    return () => clearInterval(interval);
                }, [timerActive, timeLeft, gameOver]);
                const initializeGame = () => {
                    const gameCards = [...emojis, ...emojis].map((emoji, index) => ({
                        id: index,
                        emoji
                    }));

                    for (let i = gameCards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [gameCards[i], gameCards[j]] = [gameCards[j], gameCards[i]];
                    }

                    setCards(gameCards);
                    setFlippedCards([]);
                    setMatchedCards([]);
                    setGameOver(false);
                    setTimeLeft(60);
                    setTimerActive(true);
                };

                const flipCard = (cardId) => {
                    if (gameOver || flippedCards.length === 2 || flippedCards.includes(cardId) || matchedCards.includes(cardId)) {
                        return;
                    }

                    const newFlipped = [...flippedCards, cardId];
                    setFlippedCards(newFlipped);

                    if (newFlipped.length === 2) {
                        const [first, second] = newFlipped;
                        const firstCard = cards.find(c => c.id === first);
                        const secondCard = cards.find(c => c.id === second);
                        if (firstCard && secondCard && firstCard.emoji === secondCard.emoji) {
                            const newMatched = [...matchedCards, first, second];
                            setMatchedCards(newMatched);

                            if (newMatched.length === cards.length) {
                                completeGame('memory-card', 3);
                                setTimerActive(false);
                                setCurrentPage('success-memory');
                                return;
                            }
                        }

                        setTimeout(() => setFlippedCards([]), 1000);
                    }
                };
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-400 via-purple-500 to-cyan-400 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-pink-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🎴 記憶遊戲</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        翻開相同的卡片進行配對！✨
                                    </p>
                                    <div className="text-center mt-2">
                                        <span className={`text-lg font-black ${timeLeft <= 10 ? 'text-red-200 animate-pulse' : 'text-white'}`}>
                                            ⏰ {formatTime(timeLeft)}
                                        </span>
                                    </div>
                                </div>
                                <div className="p-6">
                                    {!gameOver && matchedCards.length < cards.length ? (
                                        <div className="grid grid-cols-4 gap-2">
                                            {cards.map((card) => (
                                                <button
                                                    key={card.id}
                                                    onClick={() => flipCard(card.id)}
                                                    className={`aspect-square text-2xl rounded-xl transition-all duration-300 border-2 border-white shadow-lg ${
                                                        flippedCards.includes(card.id) || matchedCards.includes(card.id)
                                                        ? 'bg-gradient-to-r from-yellow-200 to-pink-200 shadow-xl'
                                                            : 'bg-gradient-to-r from-purple-400 to-pink-400 hover:from-purple-500 hover:to-pink-500'
                                                        } ${matchedCards.includes(card.id) ? 'opacity-60' : ''}`}
                                                >
                                                    {flippedCards.includes(card.id) || matchedCards.includes(card.id) ? card.emoji : '💫'}
                                                </button>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">⏰ 時間到了</div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                已配對: {matchedCards.length / 2} / 8 組
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">❌ 遊戲失敗！未獲得點數</div>
                                            <button
                                                onClick={initializeGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                再挑戰一次! 💪
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                回到首頁 🏠
                            </button>
                        </div>
                    </div>
                );
            };

            // 成功頁面組件
            const SuccessPage = ({ title, emoji, points, gameId }) => (
                <div className="min-h-screen bg-gradient-to-br from-green-300 via-emerald-400 to-teal-500 p-4 flex items-center justify-center no-zoom">
                    <div className="max-w-sm mx-auto text-center">
                        <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-8 shadow-2xl border-4 border-white">
                            <div className="text-6xl mb-4 animate-bounce">{emoji}</div>
                            <h2 className="text-3xl font-black text-green-700 mb-4">{title}</h2>
                            <div className="space-y-3 mb-6">
                                <div className="text-xl font-black text-green-600 bg-yellow-200 rounded-full px-6 py-3 animate-pulse">
                                    ✅ 獲得 {points} 點數！⭐
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button
                                    onClick={() => setCurrentPage(gameId)}
                                    className="mobile-button w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    🎮 再玩一次
                                </button>
                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className="mobile-button w-full bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    🏠 回到主畫面
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // 根據當前頁面渲染
            const renderPage = () => {
                switch (currentPage) {
                    case 'guess-number':
                        return <GuessNumberGame />;
                    case 'memory-card':
                        return <MemoryCardGame />;
                    case 'jigsaw-puzzle':
                        return <JigsawPuzzleGame />;
                    case 'success-number':
                        return <SuccessPage title="恭喜過關！" emoji="🎉" points={3} gameId="guess-number" />;
                    case 'success-memory':
                        return <SuccessPage title="記憶達人！" emoji="🎉" points={3} gameId="memory-card" />;
                    case 'success-puzzle':
                        // 修正點數為 8，與 games 列表保持一致
                        return <SuccessPage title="拼圖大師！" emoji="🧩" points={8} gameId="jigsaw-puzzle" />;
                    default:
                        return <HomePage />;
                }
            };

            return renderPage();
        };

        ReactDOM.render(<BirthdayGameApp />, document.getElementById('root'));
    </script>
</body>
</html>
