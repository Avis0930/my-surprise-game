<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Special GAME 🌟</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }
        .mobile-button {
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .no-zoom {
            touch-action: pan-x pan-y;
        }
        /* 定義地鼠動畫 */
        @keyframes whack-in {
            0% { transform: translateY(100%) scale(0.8); }
            50% { transform: translateY(-10%) scale(1.1); }
            100% { transform: translateY(0) scale(1); }
        }
        @keyframes whack-out {
            0% { transform: translateY(0) scale(1); }
            100% { transform: translateY(100%) scale(0.8); }
        }
        .mole-active {
            animation: whack-in 0.2s forwards;
        }
        .mole-hit {
            animation: whack-out 0.2s forwards;
            filter: grayscale(100%); /* 點擊後變灰 */
        }
        .mole-disappear {
            animation: whack-out 0.2s forwards;
        }

        /* Candy Crush 遊戲樣式 */
        .candy-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 2px;
            width: 100%; /* 確保網格在容器內填滿 */
            max-width: 300px; /* 限制最大寬度，避免過大 */
            margin: 0 auto; /* 置中 */
            aspect-ratio: 1 / 1; /* 保持正方形 */
            background-color: #8B4513; /* 巧克力色背景 */
            padding: 5px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .candy-tile {
            width: 100%;
            padding-bottom: 100%; /* Make them square */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem; /* 糖果表情符號大小 */
            border-radius: 8px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.1); /* 淺色背景，讓糖果更突出 */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.1s ease-out, opacity 0.2s ease-out;
            user-select: none;
            touch-action: manipulation;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
            /* 優化：告知瀏覽器這些屬性將會改變 */
            will-change: transform, opacity;
        }
        .candy-tile.selected {
            border: 3px solid #FFD700; /* 黃金邊框選中 */
            box-shadow: 0 0 15px #FFD700;
        }
        /* 優化：更快的消除動畫 */
        .candy-tile.clearing {
            animation: fadeOut 0.2s forwards; /* 消除時的動畫時間縮短 */
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.2); } /* 縮小更多以加速消失感 */
        }
        /* 優化：糖果下落動畫 */
        .candy-tile.falling {
            animation: fallDown 0.2s ease-out forwards;
        }
        @keyframes fallDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .candy-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* 抽卡圖片樣式 */
        /* 調整圖片尺寸和邊框 */
        .card-image {
            width: 100%;
            max-width: 320px; /* 放大卡片尺寸 */
            height: 320px; /* 固定高度，與 max-width 相同，以便於 cover 效果 */
            border-radius: 0.75rem; /* 圓角 */
            border: 5px solid; /* 邊框 */
            box-shadow: 0 4px 15px rgba(0,0,0,0.4); /* 更強烈的陰影 */
            transition: all 0.3s ease-in-out;
            object-fit: cover; /* 讓圖片填滿容器，可能會裁切部分內容 */
            aspect-ratio: 1 / 1; /* 保持正方形 */
        }

        /* 稀有度邊框顏色 */
        .card-image.ssr { border-color: #FFD700; /* 金色 */ }
        .card-image.sr { border-color: #8A2BE2; /* 紫色 */ }
        .card-image.r { border-color: #ADD8E6; /* 淺藍色 */ }

        /* 稀有度標籤樣式 - 增強視覺效果 */
        .rarity-tag {
            font-weight: bold;
            padding: 0.4rem 1.2rem; /* 增加內邊距 */
            border-radius: 9999px; /* 全圓角 */
            margin-top: 1.5rem; /* 增加與圖片的間距 */
            display: inline-block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* 更強的陰影 */
            font-size: 1.1rem; /* 增大字體 */
            text-transform: uppercase; /* 大寫 */
            letter-spacing: 1px; /* 增加字距 */
            position: relative; /* 為可能的進一步特效做準備 */
            overflow: hidden; /* 隱藏超出邊界的內容 */
            transition: all 0.3s ease;
        }
        .rarity-tag.ssr {
            background: linear-gradient(45deg, #FFD700 0%, #FFA500 50%, #FFCC00 100%); /* 金橙漸變 */
            color: #8B4513; /* 深棕色文字 */
            text-shadow: 1px 1px 3px rgba(255,255,255,0.7); /* 更明顯的文字陰影 */
            border: 2px solid #FFECB3; /* 淺金邊框 */
        }
        .rarity-tag.sr {
            background: linear-gradient(45deg, #8A2BE2 0%, #EE82EE 50%, #DA70D6 100%); /* 紫粉漸變 */
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
            border: 2px solid #D8BFD8; /* 淺紫邊框 */
        }
        .rarity-tag.r {
            background: linear-gradient(45deg, #ADD8E6 0%, #87CEEB 50%, #B0E0E6 100%); /* 淺藍漸變 */
            color: #333;
            text-shadow: 1px 1px 3px rgba(255,255,255,0.7);
            border: 2px solid #E0FFFF; /* 淺藍邊框 */
        }

        /* 抽卡動畫 */
        @keyframes rotate-in {
            0% { transform: scale(0.5) rotateY(180deg); opacity: 0; }
            100% { transform: scale(1) rotateY(0deg); opacity: 1; }
        }
        .card-enter {
            animation: rotate-in 0.5s forwards;
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const BirthdayGameApp = () => {
            const [currentPoints, setCurrentPoints] = useState(0);
            const [currentPage, setCurrentPage] = useState('home');
            const [gameResults, setGameResults] = useState({});
            // 抽卡狀態
            const [gameState, setGameState] = useState('ready');
            // 新增抽卡結果狀態
            const [drawResult, setDrawResult] = useState(null); // { type: 'legendary', url: '...' }
            console.log('渲染狀態:', gameState, '點數:', currentPoints);

            const games = [
                { id: 'guess-number', name: '1A2B猜數字', points: 3, difficulty: '簡單', emoji: '🔢' },
                { id: 'memory-card', name: '翻牌連連看', points: 3, difficulty: '中等', emoji: '🎴' },
                { id: 'whack-a-mole', name: '打地鼠', points: 4, difficulty: '中等', emoji: '🐭' }, // 新增打地鼠
                { id: 'candy-crush', name: '糖果消消樂', points: 2, difficulty: '簡單', emoji: '🍭' },
                // 已移除拖曳拼圖遊戲 { id: 'jigsaw-puzzle', name: '拖曳拼圖', points: 5, difficulty: '困難', emoji: '🧩' },
            ];
            const completeGame = (gameId, points) => {
                setCurrentPoints(prev => prev + points);
                setGameResults(prev => ({
                    ...prev,
                    [gameId]: (prev[gameId] || 0) + 1
                }));
            };

            // *** START: 抽卡圖片配置 - 已更新為 SSR, SR, R 等級與數量建議 ***
            const cardImages = {
                ssr: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr5.jpg',
                    // 如果您有更多 SSR 圖片，請在此添加
                ],
                sr: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr5.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr6.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr7.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr8.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr9.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr10.jpg',
                    // 如果您有更多 SR 圖片，請在此添加
                ],
                r: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r5.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r6.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r7.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r8.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r9.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r10.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r11.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r12.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r13.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r14.jpg',
                    // 如果您有更多 R 圖片，請在此添加
                ]
            };
            // *** END: 抽卡圖片配置 ***

            // 打地鼠遊戲組件 (不變動)
            const WhackAMoleGame = () => {
                const [score, setScore] = useState(0);
                const [timeLeft, setTimeLeft] = useState(30);
                const [activeHole, setActiveHole] = useState(null); // 當前有地鼠的洞
                const [gameOver, setGameOver] = useState(false);
                const [gameStarted, setGameStarted] = useState(false);
                const timerRef = useRef(null);
                const moleTimerRef = useRef(null);

                const moles = Array.from({ length: 9 }, (_, i) => i); // 9個洞

                const startGame = () => {
                    setScore(0);
                    setTimeLeft(30);
                    setActiveHole(null);
                    setGameOver(false);
                    setGameStarted(true);
                    startTimer();
                    showMole();
                };

                const startTimer = () => {
                    timerRef.current = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                clearInterval(timerRef.current);
                                clearInterval(moleTimerRef.current);
                                setGameOver(true);
                                setActiveHole(null);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                };

                const showMole = () => {
                    const randomDelay = Math.random() * (1.2 - 0.8) + 0.8; // 0.8-1.2秒出現
                    moleTimerRef.current = setTimeout(() => {
                        let newHole = Math.floor(Math.random() * moles.length);
                        while (newHole === activeHole) { // 避免連續在同一個洞
                            newHole = Math.floor(Math.random() * moles.length);
                        }
                        setActiveHole(newHole);

                        const disappearDelay = Math.random() * (2.5 - 1.5) + 1.5; // 1.5-2.5秒消失
                        setTimeout(() => {
                            if (activeHole === newHole) { // 如果還沒被擊中
                                setActiveHole(null);
                            }
                            if (!gameOver) {
                                showMole(); // 繼續顯示下一隻地鼠
                            }
                        }, disappearDelay * 1000);
                    }, randomDelay * 1000);
                };

                const whackMole = (holeIndex) => {
                    if (gameOver || activeHole !== holeIndex) {
                        return;
                    }
                    setScore(prevScore => prevScore + 1);
                    setActiveHole(null); // 地鼠被擊中後立即消失
                    
                    // 點擊後立即顯示下一隻地鼠，不等待消失動畫完成
                    if (!gameOver) {
                        clearTimeout(moleTimerRef.current); // 清除當前地鼠的消失計時器
                        showMole();
                    }
                };

                useEffect(() => {
                    return () => {
                        clearInterval(timerRef.current);
                        clearTimeout(moleTimerRef.current);
                    };
                }, []);

                // 修正 useEffect 依賴項
                useEffect(() => {
                    if (gameOver) {
                        if (score >= 15) {
                            completeGame('whack-a-mole', 4); // 更新點數為4
                            setCurrentPage('success-whack-a-mole');
                        }
                    }
                }, [gameOver, score, completeGame, setCurrentPage]); // 添加 completeGame 和 setCurrentPage

                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-300 via-lime-400 to-emerald-500 p-4 no-zoom flex items-center justify-center">
                        <div className="max-w-md mx-auto text-center w-full">
                            <div className="bg-white/95 backdrop-blur-sm border-4 border-green-500 shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
                                <h2 className="text-center font-black text-xl text-green-700 mb-2">🔨 打地鼠遊戲</h2>
                                <p className="text-center text-sm text-gray-600 font-semibold mb-4">
                                    擊中地鼠獲得分數，時間內達到15分即可過關！
                                </p>
                                <div className="flex justify-between items-center mb-4 bg-lime-100 rounded-full px-4 py-2 border-2 border-lime-200">
                                    <div className="text-lg font-bold text-green-700">分數: {score}</div>
                                    <div className={`text-xl font-bold ${timeLeft <= 10 && !gameOver ? 'text-red-500 animate-pulse' : 'text-green-700'}`}>
                                        時間: {formatTime(timeLeft)}
                                    </div>
                                </div>

                                {!gameStarted && !gameOver ? (
                                    <button
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-green-500 to-green-700 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                    >
                                        🚀 開始遊戲
                                    </button>
                                ) : gameOver ? (
                                    <div className="space-y-4">
                                        <div className="text-4xl font-black text-green-700">
                                            {score >= 15 ? '🎉 恭喜過關！' : '😅 時間結束！'}
                                        </div>
                                        <div className="text-xl font-bold text-gray-700 bg-gray-100 rounded-full px-4 py-2">
                                            最終分數: {score}
                                        </div>
                                        {score < 15 && (
                                            <div className="text-lg font-bold text-red-600 bg-red-100 rounded-full px-4 py-2">
                                                未達到 {15} 分，沒有獲得獎勵哦！
                                            </div>
                                        )}
                                        <button
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                        >
                                            🔄 再玩一次
                                        </button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-3 gap-3 bg-gradient-to-br from-yellow-700 to-orange-800 p-4 rounded-xl border-4 border-yellow-600 shadow-inner">
                                        {moles.map((holeIndex) => (
                                            <div
                                                key={holeIndex}
                                                className="relative w-full aspect-square bg-gradient-to-br from-yellow-900 to-yellow-700 rounded-full flex items-center justify-center overflow-hidden"
                                                style={{ boxShadow: 'inset 0 0 10px rgba(0,0,0,0.5)' }}
                                                onClick={() => whackMole(holeIndex)}
                                            >
                                                {activeHole === holeIndex ? (
                                                    <span className="absolute inset-0 flex items-center justify-center text-6xl cursor-pointer select-none mole-active">
                                                            🐹
                                                    </span>
                                                ) : (
                                                    <span className="text-4xl text-yellow-600 select-none">🕳️</span>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                            >
                                🏠 回到首頁
                            </button>
                        </div>
                    </div>
                );
            };

            // 糖果消消樂遊戲組件
            const CandyCrushGame = () => {
                const candies = ['🍭', '🍬', '🍫', '🧁', '🍩'];
                const rows = 6;
                const cols = 6;
                const targetScore = 500; 

                // 使用 state 儲存帶有狀態的 grid (例如是否正在清除、下落)
                const [grid, setGrid] = useState([]);
                const [score, setScore] = useState(0);
                const [timeLeft, setTimeLeft] = useState(30);
                const [gameOver, setGameOver] = useState(false);
                const [gameStarted, setGameStarted] = useState(false);
                const [selectedCandy, setSelectedCandy] = useState(null); // {row, col}
                const gameIntervalRef = useRef(null);

                // 生成初始網格
                const generateInitialGrid = () => {
                    const newGrid = Array(rows).fill(null).map(() => Array(cols).fill(null));
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c < cols; c++) {
                            newGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'normal' };
                        }
                    }
                    // 確保初始網格沒有直接可消除的組合
                    let hasMatch = true;
                    while (hasMatch) {
                        hasMatch = false;
                        const matches = checkMatches(newGrid);
                        if (matches.length > 0) {
                            hasMatch = true;
                            // 重新隨機化有匹配的糖果
                            matches.forEach(({ r, c }) => {
                                newGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'normal' };
                            });
                        }
                    }
                    return newGrid;
                };

                // 檢查是否有連線並返回所有匹配的糖果位置
                const checkMatches = (currentGrid) => {
                    const matches = new Set(); // 使用 Set 儲存 'r-c' 字符串，避免重複
                
                    // 檢查水平連線
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c <= cols - 3; c++) {
                            const candy = currentGrid[r][c].emoji;
                            if (candy && candy === currentGrid[r][c + 1].emoji && candy === currentGrid[r][c + 2].emoji) {
                                // 找到至少3個連線
                                let lineLength = 3;
                                while (c + lineLength < cols && candy === currentGrid[r][c + lineLength].emoji) {
                                    lineLength++;
                                }
                                for (let i = 0; i < lineLength; i++) {
                                    matches.add(`${r}-${c + i}`);
                                }
                            }
                        }
                    }
                
                    // 檢查垂直連線
                    for (let c = 0; c < cols; c++) {
                        for (let r = 0; r <= rows - 3; r++) {
                            const candy = currentGrid[r][c].emoji;
                            if (candy && candy === currentGrid[r + 1][c].emoji && candy === currentGrid[r + 2][c].emoji) {
                                // 找到至少3個連線
                                let lineLength = 3;
                                while (r + lineLength < rows && candy === currentGrid[r + lineLength][c].emoji) {
                                    lineLength++;
                                }
                                for (let i = 0; i < lineLength; i++) {
                                    matches.add(`${r + i}-${c}`);
                                }
                            }
                        }
                    }
                    return Array.from(matches).map(pos => {
                        const [r, c] = pos.split('-').map(Number);
                        return { r, c };
                    });
                };
                
                // 執行消除、分數計算、下落、補充，並遞迴檢查連擊
                const processMatches = async (initialGrid) => {
                    let currentGrid = JSON.parse(JSON.stringify(initialGrid));
                    let totalScoreFromThisMove = 0;

                    while (true) {
                        const matches = checkMatches(currentGrid);
                        if (matches.length === 0) {
                            break; // 沒有可消除的了，結束
                        }

                        // 計算本次消除的分數
                        const matchedGroups = groupMatches(matches); // 將匹配的位置分組
                        matchedGroups.forEach(group => {
                            const length = group.length;
                            if (length === 3) totalScoreFromThisMove += 30; // 3顆得分30
                            else if (length === 4) totalScoreFromThisMove += 60; // 4顆得分60
                            else if (length >= 5) totalScoreFromThisMove += 100; // 5顆或更多得分100
                        });

                        // 標記要消除的糖果為 null，並添加 'clearing' 狀態
                        matches.forEach(({ r, c }) => {
                            currentGrid[r][c].status = 'clearing';
                        });
                        // 使用 requestAnimationFrame 確保在下一個動畫幀更新 UI
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid))); // 更新 UI 顯示消除動畫
                            resolve();
                        }));

                        await new Promise(resolve => setTimeout(resolve, 200)); // 讓消除動畫播放時間縮短

                        // 將已清除的糖果設為 null，開始下落
                        matches.forEach(({ r, c }) => {
                            currentGrid[r][c] = { emoji: null, status: 'cleared' }; // 標記為 cleared
                        });

                        // 下落
                        for (let c = 0; c < cols; c++) {
                            let writeRow = rows - 1;
                            for (let r = rows - 1; r >= 0; r--) {
                                if (currentGrid[r][c].emoji !== null) {
                                    currentGrid[writeRow][c] = currentGrid[r][c];
                                    writeRow--;
                                }
                            }
                            for (let r = writeRow; r >= 0; r--) {
                                currentGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'falling' };
                            }
                        }
                        
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid))); // 更新 UI 顯示下落和補充
                            resolve();
                        }));

                        await new Promise(resolve => setTimeout(resolve, 200)); // 讓下落動畫播放時間縮短

                        // 將所有糖果狀態恢復正常
                        for (let r = 0; r < rows; r++) {
                            for (let c = 0; c < cols; c++) {
                                currentGrid[r][c].status = 'normal';
                            }
                        }
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid))); // 更新 UI 顯示最終狀態
                            resolve();
                        }));

                        // 檢查是否有新的連擊，如果有則繼續迴圈
                    }
                    setScore(s => s + totalScoreFromThisMove); // 將總分加到遊戲分數
                };


                // 輔助函數：將匹配的單個位置分組為實際的連線
                const groupMatches = (matches) => {
                    const visited = new Set();
                    const groups = [];

                    matches.forEach(match => {
                        const { r, c } = match;
                        if (!visited.has(`${r}-${c}`)) {
                            const currentGroup = [];
                            const queue = [{ r, c }];
                            visited.add(`${r}-${c}`);
                            
                            while (queue.length > 0) {
                                const { r: currR, c: currC } = queue.shift();
                                currentGroup.push({ r: currR, c: currC });

                                const directions = [
                                    [-1, 0], [1, 0], [0, -1], [0, 1] // Up, Down, Left, Right
                                ];

                                for (const [dr, dc] of directions) {
                                    const newR = currR + dr;
                                    const newC = currC + dc;

                                    if (
                                        matches.some(m => m.r === newR && m.c === newC) && // 是匹配的一部分
                                        !visited.has(`${newR}-${newC}`)
                                    ) {
                                        visited.add(`${newR}-${newC}`);
                                        queue.push({ r: newR, c: newC });
                                    }
                                }
                            }
                            groups.push(currentGroup);
                        }
                    });
                    return groups;
                };


                const startGame = () => {
                    setScore(0);
                    setTimeLeft(30);
                    setGameOver(false);
                    setGameStarted(true);
                    setSelectedCandy(null);
                    const initialGrid = generateInitialGrid();
                    setGrid(initialGrid);

                    clearInterval(gameIntervalRef.current);
                    gameIntervalRef.current = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                clearInterval(gameIntervalRef.current);
                                setGameOver(true);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                };

                // 修正 useEffect 依賴項
                useEffect(() => {
                    if (gameOver) {
                        clearInterval(gameIntervalRef.current);
                        if (score >= targetScore) {
                            completeGame('candy-crush', 5); 
                            setCurrentPage('success-candy-crush');
                        }
                    }
                }, [gameOver, score, targetScore, completeGame, setCurrentPage]); // 添加所有外部依賴項

                useEffect(() => {
                    return () => clearInterval(gameIntervalRef.current);
                }, []); // 這裡的依賴項是空的，因為只在組件卸載時執行

                const handleCandyClick = async (r, c) => {
                    if (gameOver || !gameStarted) return;

                    if (selectedCandy) {
                        // 第二次點擊
                        const prevR = selectedCandy.r;
                        const prevC = selectedCandy.c;

                        // 檢查是否為相鄰糖果
                        const isAdjacent = (
                            (Math.abs(r - prevR) === 1 && c === prevC) ||
                            (Math.abs(c - prevC) === 1 && r === prevR)
                        );

                        if (isAdjacent) {
                            const newGrid = JSON.parse(JSON.stringify(grid));
                            // 在新的複製網格上交換
                            [newGrid[r][c].emoji, newGrid[prevR][prevC].emoji] = [newGrid[prevR][prevC].emoji, newGrid[r][c].emoji];
                            
                            // 立即更新 UI 顯示交換
                            await new Promise(resolve => requestAnimationFrame(() => {
                                setGrid(newGrid);
                                resolve();
                            }));
                            
                            // 檢查交換後是否有連線
                            const hasMatch = checkMatches(newGrid).length > 0;
                            if (hasMatch) {
                                // 有連線，消除並補充 (等待 processMatches 完成)
                                await processMatches(newGrid); 
                            } else {
                                // 沒有連線，換回來
                                await new Promise(resolve => setTimeout(resolve, 200)); // 給一點時間讓玩家看到交換但沒消除
                                [newGrid[r][c].emoji, newGrid[prevR][prevC].emoji] = [newGrid[prevR][prevC].emoji, newGrid[r][c].emoji]; // 換回來
                                await new Promise(resolve => requestAnimationFrame(() => {
                                    setGrid(newGrid);
                                    resolve();
                                }));
                            }
                        }
                        setSelectedCandy(null); // 清除選取
                    } else {
                        // 第一次點擊
                        setSelectedCandy({ r, c });
                    }
                };

                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-300 via-orange-400 to-yellow-500 p-4 no-zoom flex items-center justify-center">
                        <div className="max-w-md mx-auto text-center w-full">
                            <div className="bg-white/95 backdrop-blur-sm border-4 border-orange-500 shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
                                <h2 className="text-center font-black text-xl text-orange-700 mb-2">🍬 糖果消消樂</h2>
                                <p className="text-center text-sm text-gray-600 font-semibold mb-4">
                                    交換糖果，達成3個以上連線消除！目標分數 {targetScore}！
                                </p>
                                <div className="flex justify-between items-center mb-4 bg-yellow-100 rounded-full px-4 py-2 border-2 border-yellow-200">
                                    <div className="text-lg font-bold text-orange-700">分數: {score}</div>
                                    <div className={`text-xl font-bold ${timeLeft <= 10 && !gameOver ? 'text-red-500 animate-pulse' : 'text-orange-700'}`}>
                                        時間: {formatTime(timeLeft)}
                                    </div>
                                </div>

                                {!gameStarted && !gameOver ? (
                                    <button
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-orange-500 to-orange-700 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                    >
                                        🚀 開始遊戲
                                    </button>
                                ) : gameOver ? (
                                    <div className="space-y-4">
                                        <div className="text-4xl font-black text-orange-700">
                                            {score >= targetScore ? '🎉 恭喜過關！' : '😅 時間結束！'}
                                        </div>
                                        <div className="text-xl font-bold text-gray-700 bg-gray-100 rounded-full px-4 py-2">
                                            最終分數: {score}
                                        </div>
                                        {score < targetScore && (
                                            <div className="text-lg font-bold text-red-600 bg-red-100 rounded-full px-4 py-2">
                                                未達到 {targetScore} 分，沒有獲得獎勵哦！
                                            </div>
                                        )}
                                        <button
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                        >
                                            🔄 再玩一次
                                        </button>
                                    </div>
                                ) : (
                                    <div className="candy-grid">
                                        {grid.map((row, rIdx) =>
                                            row.map((candyData, cIdx) => (
                                                <div
                                                    key={`${rIdx}-${cIdx}`}
                                                    className={`candy-tile ${selectedCandy?.r === rIdx && selectedCandy?.c === cIdx ? 'selected' : ''} ${candyData.status === 'clearing' ? 'clearing' : ''} ${candyData.status === 'falling' ? 'falling' : ''}`}
                                                    onClick={() => handleCandyClick(rIdx, cIdx)}
                                                >
                                                    <span className="candy-content">{candyData.emoji}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                            >
                                🏠 回到首頁
                            </button>
                        </div>
                    </div>
                );
            };

            // 已移除拖曳拼圖遊戲
            // const JigsawPuzzleGame = () => { /* ... (此處原拼圖遊戲代碼已被移除) ... */ };

            // 抽卡機制
            const addPoints = () => {
                setCurrentPoints(p => p + 10);
                setGameState('ready');
                console.log('+10點，重置為ready');
            };

            const drawCard = () => {
                if (currentPoints < 5 || gameState !== 'ready') return;
                setCurrentPoints(p => p - 5);
                setGameState('drawing');
                console.log('開始抽卡，狀態->drawing');
                
                setTimeout(() => {
                    // 根據抽卡結果設定 drawResult (隨機選一張圖片)
                    const rarityRoll = Math.random();
                    let chosenCardUrl = null;
                    let chosenType = '';

                    // SSR: 20% (0.0 - 0.2), SR: 30% (0.2 - 0.5), R: 50% (0.5 - 1.0)
                    if (rarityRoll < 0.2) { // 20% for SSR
                        chosenType = 'ssr';
                        chosenCardUrl = cardImages.ssr[Math.floor(Math.random() * cardImages.ssr.length)];
                    } else if (rarityRoll < 0.5) { // 30% for SR (0.2 + 0.3 = 0.5)
                        chosenType = 'sr';
                        chosenCardUrl = cardImages.sr[Math.floor(Math.random() * cardImages.sr.length)];
                    } else { // 50% for R
                        chosenType = 'r';
                        chosenCardUrl = cardImages.r[Math.floor(Math.random() * cardImages.r.length)];
                    }
                    
                    setDrawResult({ type: chosenType, url: chosenCardUrl });
                    setGameState('result');
                    console.log('計時器執行，狀態->result');
                }, 2000);
            };

            const resetGame = () => {
                setGameState('ready');
                console.log('重置，狀態->ready');
                setDrawResult(null); // 重置抽卡結果
            };

            // 首頁
            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-cyan-300 via-purple-400 to-pink-400 p-4 no-zoom">
                    <div className="max-w-sm mx-auto">
                        <div className="text-center mb-6">
                            <div className="bg-white/90 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-4 border-white">
                                <h1 className="text-2xl sm:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500 mb-2">
                                    Special GAME
                                </h1>
                                <p className="text-purple-700 font-semibold text-sm">完成遊戲獲得點數，集滿5點抽驚喜卡片！</p>
                                <div className="flex justify-center space-x-2 mt-3">
                                    <span className="text-2xl">💖</span>
                                    <span className="text-2xl">🌈</span>
                                    <span className="text-2xl">✨</span>
                                </div>
                            </div>
                        </div>

                        {/* 控制按鈕 */}
                        <div className="fixed top-4 left-4 space-y-2">
                            <button onClick={addPoints} className="bg-red-600 text-white px-4 py-2 rounded font-bold">
                                +10點
                            </button>
                            <button onClick={resetGame} className="bg-gray-600 text-white px-4 py-2 rounded font-bold">
                                重置
                            </button>
                        </div>

                        {/* 點數顯示 */}
                        <div className="mb-6 bg-gradient-to-r from-yellow-300 to-orange-300 border-4 border-white shadow-xl rounded-2xl p-6 text-center">
                            <div className="text-2xl font-black text-white mb-2 drop-shadow-lg">
                                ⭐ 點數: {currentPoints} ⭐
                            </div>
                            <div className="text-base font-bold text-purple-800 bg-white/80 rounded-full px-4 py-1">
                                {Math.floor(currentPoints / 5)} 次抽卡機會 🎴
                            </div>
                        </div>

                        {/* 抽卡區域 */}
                        <div className="bg-gradient-to-r from-yellow-300 via-pink-300 to-purple-300 border-4 border-white rounded-2xl p-6 mb-6">
                            {/* START: 抽卡區標題調整 */}
                            <h3 className="font-black text-xl mb-4 text-white text-center">✨ 您的卡片 ✨</h3>
                            {/* END: 抽卡區標題調整 */}
                            
                            <div className="text-center">
                                {/* READY 狀態 */}
                                {gameState === 'ready' && (
                                    <div>
                                        {currentPoints >= 5 ? (
                                            <button
                                                onClick={drawCard}
                                                className="w-full bg-cyan-500 text-white px-6 py-4 rounded-full text-lg font-black hover:bg-cyan-600"
                                            >
                                                🎴 抽卡片！(-5點) ✨
                                            </button>
                                        ) : (
                                            <div className="bg-white/90 rounded-full px-4 py-3">
                                                <p className="text-purple-700 font-bold">還需要 {5 - currentPoints} 點才能抽卡 ✨</p>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* DRAWING 狀態 */}
                                {gameState === 'drawing' && (
                                    <div className="space-y-4">
                                        <div className="text-6xl animate-spin">🎴</div>
                                        <div className="text-white font-bold text-xl animate-pulse">抽卡中...</div>
                                    </div>
                                )}

                                {/* RESULT 狀態 - 優化排版和文字 */}
                                {gameState === 'result' && drawResult && (
                                    <div className="flex flex-col items-center justify-center space-y-4 card-enter">
                                        {drawResult.url && (
                                            <img
                                                src={drawResult.url}
                                                alt={drawResult.type}
                                                className={`card-image ${drawResult.type}`}
                                            />
                                        )}
                                        {/* START: 稀有度標籤優化 */}
                                        <div className={`rarity-tag ${drawResult.type}`}>
                                            {drawResult.type.toUpperCase()}
                                        </div>
                                        {/* END: 稀有度標籤優化 */}
                                        
                                        <button
                                            onClick={resetGame}
                                            className="w-full bg-purple-500 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-600"
                                        >
                                            繼續遊戲 💫
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* 遊戲列表 */}
                        <div className="space-y-4">
                            {games.map((game, index) => {
                                const gradients = [
                                    'from-pink-400 to-rose-400',
                                    'from-cyan-400 to-blue-400', 
                                    'from-purple-400 to-violet-400',
                                    'from-green-400 to-emerald-400'
                                ];
                                return (
                                    <div key={game.id} className={`bg-gradient-to-r ${gradients[index % gradients.length]} border-4 border-white shadow-xl rounded-2xl`}>
                                        <div className="p-4">
                                            <div className="flex justify-between items-center">
                                                <div className="flex-1">
                                                    <h3 className="font-black text-lg text-white drop-shadow-lg">
                                                        {game.emoji} {game.name}
                                                    </h3>
                                                    <p className="text-sm text-white/90 font-semibold">
                                                        {game.difficulty} | {game.points}點 ⭐
                                                    </p>
                                                    {gameResults[game.id] && (
                                                        <p className="text-sm text-yellow-200 font-bold">
                                                            🎉 完成 {gameResults[game.id]} 次
                                                        </p>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => setCurrentPage(game.id)}
                                                    className="mobile-button bg-white text-purple-700 px-4 py-2 rounded-full font-black hover:bg-yellow-300 transition-all shadow-lg text-sm"
                                                >
                                                    START! 💫
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
            // 猜數字遊戲
            const GuessNumberGame = () => {
                const [targetNumber, setTargetNumber] = useState('');
                const [guess, setGuess] = useState('');
                const [history, setHistory] = useState([]);
                const [attempts, setAttempts] = useState(0);
                const [gameOver, setGameOver] = useState(false);
                
                useEffect(() => {
                    resetNumberGame(); // 確保每次進入遊戲都初始化
                }, []); // 空依賴陣列表示只在組件 mount 時執行一次
                
                const generateNewTargetNumber = () => {
                    const digits = [];
                    while (digits.length < 3) {
                        const digit = Math.floor(Math.random() * 10).toString();
                        if (!digits.includes(digit)) {
                            digits.push(digit);
                        }
                    }
                    return digits.join('');
                };

                const checkGuess = () => {
                    if (guess.length !== 3 || new Set(guess).size !== 3) {
                        alert('請輸入3位不重複數字！');
                        return;
                    }

                    let a = 0, b = 0;
                    for (let i = 0; i < 3; i++) {
                        if (guess[i] === targetNumber[i]) {
                            a++;
                        } else if (targetNumber.includes(guess[i])) {
                            b++;
                        }
                    }

                    const result = `${guess} - ${a}A${b}B`;
                    setHistory([result, ...history]);
                    setAttempts(attempts + 1);

                    if (a === 3) {
                        completeGame('guess-number', 3);
                        setCurrentPage('success-number');
                        return;
                    } else if (attempts + 1 >= 10) {
                        setGameOver(true);
                    }

                    setGuess('');
                };

                // 修正 resetNumberGame 依賴項
                const resetNumberGame = () => {
                    setGameOver(false);
                    setHistory([]);
                    setGuess('');
                    setAttempts(0);
                    setTargetNumber(generateNewTargetNumber());
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-cyan-400 via-purple-500 to-pink-500 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-blue-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🔢 數字遊戲</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        猜出3位不重複數字！A=位置和數字都對，B=數字對但位置錯 ✨
                                    </p>
                                    <p className="text-center text-xs text-white/80 mt-1">
                                        剩餘機會: {10 - attempts} 次
                                    </p>
                                </div>
                                <div className="p-6">
                                    {!gameOver ? (
                                        <div className="space-y-4">
                                            <div className="space-y-3">
                                                <input
                                                    type="tel"
                                                    value={guess}
                                                    onChange={(e) => setGuess(e.target.value.replace(/\D/g, '').slice(0, 3))}
                                                    placeholder="輸入3位數字"
                                                    className="w-full p-4 border-4 border-purple-300 rounded-full text-center text-xl font-bold focus:border-pink-400 focus:outline-none bg-white text-gray-800"
                                                    maxLength={3}
                                                />
                                                <button
                                                    onClick={checkGuess}
                                                    className="w-full bg-gradient-to-r from-cyan-400 to-blue-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-2 border-white"
                                                >
                                                    猜測! 💫
                                                </button>
                                            </div>
                                            
                                            <div className="max-h-48 overflow-y-auto space-y-2">
                                                {history.map((result, index) => (
                                                    <div key={index} className="p-3 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full text-center font-bold text-purple-700 border-2 border-purple-200">
                                                        {result}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">😅 遊戲結束</div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                答案是: {targetNumber}
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">❌ 遊戲失敗！未獲得點數</div>
                                            <button
                                                onClick={resetNumberGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                再挑戰一次! 💪
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                回到首頁 🏠
                            </button>
                        </div>
                    </div>
                );
            };

            // 翻牌連連看遊戲
            const MemoryCardGame = () => {
                const [cards, setCards] = useState([]);
                const [flippedCards, setFlippedCards] = useState([]);
                const [matchedCards, setMatchedCards] = useState([]);
                const [gameOver, setGameOver] = useState(false);
                const [timeLeft, setTimeLeft] = useState(60);
                const [timerActive, setTimerActive] = useState(false);

                const emojis = ['💖', '🌈', '✨', '🌟', '💫', '🎉', '🎈', '🦄'];
                
                useEffect(() => {
                    initializeGame();
                }, []); // 初始只執行一次

                // 修正 useEffect 依賴項
                useEffect(() => {
                    let interval = null;
                    if (timerActive && timeLeft > 0 && !gameOver) {
                        interval = setInterval(() => {
                            setTimeLeft(timeLeft => {
                                if (timeLeft <= 1) {
                                    setGameOver(true);
                                    setTimerActive(false);
                                    return 0;
                                }
                                return timeLeft - 1;
                            });
                        }, 1000);
                    } else if (timeLeft === 0 && !gameOver) { // 時間結束時觸發遊戲結束
                        setGameOver(true);
                        setTimerActive(false);
                    }
                    return () => clearInterval(interval);
                }, [timerActive, timeLeft, gameOver]); // 添加所有外部依賴項
                
                // 修正 initializeGame 依賴項
                const initializeGame = () => {
                    const gameCards = [...emojis, ...emojis].map((emoji, index) => ({
                        id: index,
                        emoji
                    }));
                    
                    for (let i = gameCards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [gameCards[i], gameCards[j]] = [gameCards[j], gameCards[i]];
                    }
                    
                    setCards(gameCards);
                    setFlippedCards([]);
                    setMatchedCards([]);
                    setGameOver(false);
                    setTimeLeft(60);
                    setTimerActive(true);
                };

                // 修正 flipCard 依賴項
                const flipCard = (cardId) => {
                    if (gameOver || flippedCards.length === 2 || flippedCards.includes(cardId) || matchedCards.includes(cardId)) {
                        return;
                    }

                    const newFlipped = [...flippedCards, cardId];
                    setFlippedCards(newFlipped);

                    if (newFlipped.length === 2) {
                        const [first, second] = newFlipped;
                        const firstCard = cards.find(c => c.id === first);
                        const secondCard = cards.find(c => c.id === second);
                        if (firstCard && secondCard && firstCard.emoji === secondCard.emoji) {
                            const newMatched = [...matchedCards, first, second];
                            setMatchedCards(newMatched);
                            
                            if (newMatched.length === cards.length) {
                                completeGame('memory-card', 3);
                                setTimerActive(false);
                                setCurrentPage('success-memory');
                                return;
                            }
                        }

                        setTimeout(() => setFlippedCards([]), 1000);
                    }
                };
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-400 via-purple-500 to-cyan-400 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-pink-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🎴 記憶遊戲</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        翻開相同的卡片進行配對！✨
                                    </p>
                                    <div className="text-center mt-2">
                                        <span className={`text-lg font-black ${timeLeft <= 10 ? 'text-red-200 animate-pulse' : 'text-white'}`}>
                                            ⏰ {formatTime(timeLeft)}
                                        </span>
                                    </div>
                                </div>
                                <div className="p-6">
                                    {!gameOver && matchedCards.length < cards.length ? (
                                        <div className="grid grid-cols-4 gap-2">
                                            {cards.map((card) => (
                                                <button
                                                    key={card.id}
                                                    onClick={() => flipCard(card.id)}
                                                    className={`aspect-square text-2xl rounded-xl transition-all duration-300 border-2 border-white shadow-lg ${
                                                        flippedCards.includes(card.id) || matchedCards.includes(card.id)
                                                        ? 'bg-gradient-to-r from-yellow-200 to-pink-200 shadow-xl'
                                                            : 'bg-gradient-to-r from-purple-400 to-pink-400 hover:from-purple-500 hover:to-pink-500'
                                                    } ${matchedCards.includes(card.id) ? 'opacity-60' : ''}`}
                                                >
                                                    {flippedCards.includes(card.id) || matchedCards.includes(card.id) ? card.emoji : '💫'}
                                                </button>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">
                                                {matchedCards.length === cards.length ? '🎉 恭喜過關！' : '⏰ 時間到了！'}
                                            </div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                已配對: {matchedCards.length / 2} / 8 組
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">
                                                {matchedCards.length === cards.length ? '獲得獎勵！' : '❌ 遊戲失敗！未獲得點數'}
                                            </div>
                                            <button
                                                onClick={initializeGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                再挑戰一次! 💪
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                回到首頁 🏠
                            </button>
                        </div>
                    </div>
                );
            };

            // 成功頁面組件
            const SuccessPage = ({ title, emoji, points, gameId }) => (
                <div className="min-h-screen bg-gradient-to-br from-green-300 via-emerald-400 to-teal-500 p-4 flex items-center justify-center no-zoom">
                    <div className="max-w-sm mx-auto text-center">
                        <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-8 shadow-2xl border-4 border-white">
                            <div className="text-6xl mb-4 animate-bounce">{emoji}</div>
                            <h2 className="text-3xl font-black text-green-700 mb-4">{title}</h2>
                            <div className="space-y-3 mb-6">
                                <div className="text-xl font-black text-green-600 bg-yellow-200 rounded-full px-6 py-3 animate-pulse">
                                    ✅ 獲得 {points} 點數！⭐
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button
                                    onClick={() => setCurrentPage(gameId)}
                                    className="mobile-button w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    🎮 再玩一次
                                </button>
                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className="mobile-button w-full bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    🏠 回到主畫面
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // 根據當前頁面渲染
            const renderPage = () => {
                switch (currentPage) {
                    case 'guess-number':
                        return <GuessNumberGame />;
                    case 'memory-card':
                        return <MemoryCardGame />;
                    case 'whack-a-mole': // 打地鼠遊戲
                        return <WhackAMoleGame />;
                    case 'candy-crush': // 糖果消消樂
                        return <CandyCrushGame />;
                    // 已移除拖曳拼圖遊戲 case 'jigsaw-puzzle':
                    // 已移除拖曳拼圖遊戲    return <JigsawPuzzleGame />;
                    case 'success-number':
                        return <SuccessPage title="恭喜過關！" emoji="🎉" points={3} gameId="guess-number" />;
                    case 'success-memory':
                        return <SuccessPage title="記憶達人！" emoji="🎉" points={3} gameId="memory-card" />;
                    case 'success-whack-a-mole': // 打地鼠成功頁面
                        return <SuccessPage title="地鼠剋星！" emoji="🔨" points={4} gameId="whack-a-mole" />;
                    case 'success-candy-crush': // 糖果消消樂成功頁面
                        return <SuccessPage title="甜點大師！" emoji="🍬" points={5} gameId="candy-crush" />;
                    // 已移除拖曳拼圖遊戲 case 'success-puzzle':
                    // 已移除拖曳拼圖遊戲    return <SuccessPage title="拼圖大師！" emoji="🧩" points={5} gameId="jigsaw-puzzle" />;
                    default:
                        return <HomePage />;
                }
            };

            return renderPage();
        };

        ReactDOM.render(<BirthdayGameApp />, document.getElementById('root'));
    </script>
</body>
</html>
