<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Special GAME 🌟</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }
        .mobile-button {
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .no-zoom {
            /* 讓在手機上操作時不會因為點擊或滑動而縮放頁面 */
            touch-action: pan-x pan-y;
        }
        /* 針對滑動拼圖的過渡效果 */
        .puzzle-piece {
            transition: transform 0.2s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React; // 加入 useRef 以便使用

        const BirthdayGameApp = () => {
            const [currentPoints, setCurrentPoints] = useState(0);
            const [currentPage, setCurrentPage] = useState('home');
            const [history, setHistory] = useState([]); // 用於儲存頁面歷史
            const [completedGames, setCompletedGames] = useState({}); // 記錄已完成的遊戲

            // 遊戲資料
            const games = [
                { id: 'guess-number', name: '猜數字遊戲', description: '數字秘密，等你來猜！', points: 3, page: 'guess-number' },
                { id: 'memory-card', name: '記憶翻牌遊戲', description: '考驗你的記憶力！', points: 3, page: 'memory-card' },
                { id: 'jigsaw-puzzle', name: '滑動拼圖遊戲', description: '碎片拼湊，展現大圖！', points: 5, page: 'jigsaw-puzzle' },
                { id: 'gacha-game', name: '幸運抽卡遊戲', description: '試試手氣，抽大獎！', points: 5, page: 'gacha-game' } // 重新加入抽卡遊戲的入口
            ];

            // 導航到指定頁面
            const navigateTo = (page, params = {}) => {
                setHistory(prev => [...prev, currentPage]); // 儲存當前頁面
                setCurrentPage(page);
                // 可以在這裡處理參數，如果需要的話
            };

            // 返回上一頁
            const goBack = () => {
                if (history.length > 0) {
                    const prevPage = history.pop();
                    setCurrentPage(prevPage);
                    setHistory([...history]); // 更新 history 狀態以觸發重新渲染
                } else {
                    setCurrentPage('home'); // 如果沒有歷史，回到主頁
                }
            };

            // 處理遊戲完成並增加點數
            const handleGameComplete = (gameId, pointsAwarded) => {
                setCurrentPoints(prevPoints => prevPoints + pointsAwarded);
                setCompletedGames(prev => ({ ...prev, [gameId]: true }));
            };

            // 首頁組件
            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-blue-400 to-purple-500 flex flex-col items-center justify-center p-4 text-white">
                    <h1 className="text-5xl font-black mb-6 text-yellow-300 drop-shadow-lg animate-bounce">
                        🌟 生日驚喜遊戲 🌟
                    </h1>
                    <p className="text-xl mb-8 text-center px-4 max-w-md">
                        歡迎進入這個充滿驚喜的遊戲世界！完成每個挑戰，累積你的驚喜點數！
                    </p>
                    <div className="w-full max-w-md bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-2xl border-4 border-white transform hover:scale-105 transition duration-300 ease-in-out">
                        <h2 className="text-3xl font-bold mb-6 text-center text-yellow-200">你的點數：{currentPoints} 點</h2>
                        <div className="space-y-4">
                            {games.map(game => (
                                <button
                                    key={game.id}
                                    onClick={() => navigateTo(game.page)}
                                    disabled={completedGames[game.id]}
                                    className={`w-full text-lg font-bold py-4 px-6 rounded-xl shadow-lg transform transition duration-200 ease-in-out mobile-button
                                        ${completedGames[game.id]
                                            ? 'bg-gray-500 bg-opacity-70 text-gray-200 cursor-not-allowed'
                                            : 'bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white hover:scale-102'
                                        }`}
                                >
                                    {completedGames[game.id] ? `✅ ${game.name} (已完成)` : `${game.name} - 🎁 ${game.points} 點`}
                                    <p className="text-sm font-normal mt-1 opacity-80">{game.description}</p>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            // 猜數字遊戲組件 (這裡的程式碼是基於您原始的版本，應該是好的)
            const GuessNumberGame = () => {
                const [targetNumber] = useState(Math.floor(Math.random() * 100) + 1);
                const [guess, setGuess] = useState('');
                const [message, setMessage] = useState('猜一個 1 到 100 的數字！');
                const [attempts, setAttempts] = useState(0);
                const [isCorrect, setIsCorrect] = useState(false);
                const inputRef = useRef(null);

                const handleGuess = () => {
                    const numGuess = parseInt(guess);
                    if (isNaN(numGuess) || numGuess < 1 || numGuess > 100) {
                        setMessage('請輸入 1 到 100 之間的有效數字！');
                        return;
                    }
                    setAttempts(prev => prev + 1);

                    if (numGuess === targetNumber) {
                        setMessage(`恭喜你！猜對了！你用了 ${attempts + 1} 次！`);
                        setIsCorrect(true);
                        handleGameComplete('guess-number', games.find(g => g.id === 'guess-number').points);
                        // 移除 navigateTo('success-number'); 讓用戶停留在成功畫面
                    } else if (numGuess < targetNumber) {
                        setMessage('太低了！再高一點！');
                    } else {
                        setMessage('太高了！再低一點！');
                    }
                    setGuess('');
                    inputRef.current.focus();
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-400 to-teal-500 flex flex-col items-center justify-center p-4 text-white">
                        <h2 className="text-4xl font-bold mb-6 text-yellow-300 drop-shadow-lg">猜數字遊戲</h2>
                        <div className="w-full max-w-md bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-2xl border-4 border-white">
                            <p className="text-xl mb-6 text-center">{message}</p>
                            {!isCorrect && (
                                <div className="flex flex-col items-center space-y-4">
                                    <input
                                        type="number"
                                        value={guess}
                                        onChange={(e) => setGuess(e.target.value)}
                                        onKeyPress={(e) => { if (e.key === 'Enter') handleGuess(); }}
                                        className="w-full p-3 text-2xl text-center text-gray-800 bg-white rounded-lg border-2 border-blue-300 focus:outline-none focus:ring-4 focus:ring-blue-400"
                                        ref={inputRef}
                                        autoFocus
                                    />
                                    <button
                                        onClick={handleGuess}
                                        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md mobile-button"
                                    >
                                        猜！
                                    </button>
                                </div>
                            )}
                            {isCorrect && (
                                <button
                                    onClick={() => navigateTo('success-number')}
                                    className="w-full mt-6 bg-gradient-to-r from-yellow-400 to-orange-400 text-white px-6 py-3 rounded-lg font-bold shadow-md mobile-button"
                                >
                                    查看獎勵！
                                </button>
                            )}
                            <button
                                onClick={goBack}
                                className="w-full mt-6 bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-3 rounded-lg font-bold shadow-md mobile-button"
                            >
                                🏠 回到主畫面
                            </button>
                        </div>
                    </div>
                );
            };

            // 記憶翻牌遊戲組件 (這裡的程式碼是基於您原始的版本，應該是好的)
            const MemoryCardGame = () => {
                const initialCards = [
                    '😀', '😂', '😍', '🥳', '😎', '🤩', '🤖', '👾',
                    '😀', '😂', '😍', '🥳', '😎', '🤩', '🤖', '👾'
                ].sort(() => Math.random() - 0.5);

                const [cards, setCards] = useState(initialCards.map((emoji, index) => ({
                    id: index,
                    emoji,
                    isFlipped: false,
                    isMatched: false
                })));
                const [flippedCards, setFlippedCards] = useState([]);
                const [matches, setMatches] = useState(0);
                const [moves, setMoves] = useState(0);
                const [gameWon, setGameWon] = useState(false);
                const [lockBoard, setLockBoard] = useState(false);

                useEffect(() => {
                    if (flippedCards.length === 2) {
                        setLockBoard(true);
                        const [card1, card2] = flippedCards;
                        if (cards[card1.id].emoji === cards[card2.id].emoji) {
                            setMatches(prev => prev + 1);
                            setCards(prevCards =>
                                prevCards.map(card =>
                                    card.id === card1.id || card.id === card2.id
                                        ? { ...card, isMatched: true }
                                        : card
                                )
                            );
                            setFlippedCards([]);
                            setLockBoard(false);
                        } else {
                            setTimeout(() => {
                                setCards(prevCards =>
                                    prevCards.map(card =>
                                        card.id === card1.id || card.id === card2.id
                                            ? { ...card, isFlipped: false }
                                            : card
                                    )
                                );
                                setFlippedCards([]);
                                setLockBoard(false);
                            }, 1000);
                        }
                    }
                }, [flippedCards, cards]);

                useEffect(() => {
                    if (matches === initialCards.length / 2) {
                        setGameWon(true);
                        handleGameComplete('memory-card', games.find(g => g.id === 'memory-card').points);
                        // 移除 navigateTo('success-memory'); 讓用戶停留在成功畫面
                    }
                }, [matches]);

                const handleCardClick = (clickedCard) => {
                    if (lockBoard || clickedCard.isFlipped || clickedCard.isMatched) return;

                    setMoves(prev => prev + 1);
                    setCards(prevCards =>
                        prevCards.map(card =>
                            card.id === clickedCard.id ? { ...card, isFlipped: true } : card
                        )
                    );
                    setFlippedCards(prev => [...prev, clickedCard]);
                };

                const resetGame = () => {
                    const shuffledCards = initialCards.map((emoji, index) => ({
                        id: index,
                        emoji,
                        isFlipped: false,
                        isMatched: false
                    })).sort(() => Math.random() - 0.5);
                    setCards(shuffledCards);
                    setFlippedCards([]);
                    setMatches(0);
                    setMoves(0);
                    setGameWon(false);
                    setLockBoard(false);
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-400 to-red-500 flex flex-col items-center justify-center p-4 text-white">
                        <h2 className="text-4xl font-bold mb-6 text-yellow-300 drop-shadow-lg">記憶翻牌遊戲</h2>
                        <div className="w-full max-w-lg bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-2xl border-4 border-white text-center">
                            <p className="text-xl mb-4">步數: {moves}</p>
                            {!gameWon && (
                                <div className="grid grid-cols-4 gap-3 mb-6">
                                    {cards.map(card => (
                                        <div
                                            key={card.id}
                                            onClick={() => handleCardClick(card)}
                                            className={`w-full h-24 sm:h-32 bg-gray-700 bg-opacity-60 rounded-lg flex items-center justify-center text-5xl cursor-pointer transform transition duration-300 mobile-button
                                                ${card.isFlipped || card.isMatched ? 'bg-blue-300 text-gray-900' : 'hover:scale-105'}`}
                                            style={{
                                                perspective: '1000px', // 為了翻牌效果
                                                transition: 'transform 0.3s'
                                            }}
                                        >
                                            <div className="relative w-full h-full" style={{ transformStyle: 'preserve-3d' }}>
                                                <div
                                                    className={`absolute w-full h-full flex items-center justify-center rounded-lg backface-hidden ${card.isFlipped || card.isMatched ? 'rotateY-0' : 'rotateY-180'}`}
                                                    style={{
                                                        background: 'linear-gradient(to right bottom, #f0e68c, #ffd700)',
                                                        transform: card.isFlipped || card.isMatched ? 'rotateY(0deg)' : 'rotateY(180deg)'
                                                    }}
                                                >
                                                    {card.isFlipped || card.isMatched ? card.emoji : ''}
                                                </div>
                                                <div
                                                    className={`absolute w-full h-full flex items-center justify-center rounded-lg backface-hidden ${card.isFlipped || card.isMatched ? 'rotateY-180' : 'rotateY-0'}`}
                                                    style={{
                                                        background: 'linear-gradient(to right bottom, #87ceeb, #00bfff)',
                                                        transform: card.isFlipped || card.isMatched ? 'rotateY(180deg)' : 'rotateY(0deg)'
                                                    }}
                                                >
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            {gameWon && (
                                <button
                                    onClick={() => navigateTo('success-memory')}
                                    className="w-full mt-6 bg-gradient-to-r from-yellow-400 to-orange-400 text-white px-6 py-3 rounded-lg font-bold shadow-md mobile-button"
                                >
                                    查看獎勵！
                                </button>
                            )}
                            <button
                                onClick={goBack}
                                className="w-full mt-6 bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-3 rounded-lg font-bold shadow-md mobile-button"
                            >
                                🏠 回到主畫面
                            </button>
                        </div>
                    </div>
                );
            };

            // 滑動拼圖遊戲組件 (這裡保留了您之前提供且能運行的部分，並加入圖片載入判斷)
            const JigsawPuzzleGame = () => {
                const [pieces, setPieces] = useState([]);
                const [originalImageSize, setOriginalImageSize] = useState({ width: 0, height: 0 });
                const [displayImageSize, setDisplayImageSize] = useState({ width: 0, height: 0 });
                const [selectedPiece, setSelectedPiece] = useState(null); // 當前選中的拼圖塊
                const [emptySpot, setEmptySpot] = useState(null); // 空白格的位置
                const [isPuzzleActive, setIsPuzzleActive] = useState(false); // 拼圖是否可以互動
                const [isLoading, setIsLoading] = useState(true); // 圖片是否正在載入
                const [message, setMessage] = useState("載入圖片中...");

                const imageUrl = 'https://Avis0930.github.io/my-surprise-game/demo.jpg'; // 確保這是您要用的圖片路徑
                const rows = 3;
                const cols = 3;

                useEffect(() => {
                    setIsLoading(true);
                    setMessage("載入圖片中...");
                    const img = new Image();
                    img.src = imageUrl;

                    img.onload = () => {
                        // 檢查圖片是否確實有寬高
                        if (img.naturalWidth === 0 || img.naturalHeight === 0) {
                            console.error("圖片載入失敗或尺寸為零。請檢查圖片文件。", imageUrl);
                            setMessage("圖片載入失敗或尺寸異常。");
                            setIsLoading(false);
                            return;
                        }

                        // 計算拼圖顯示的尺寸，使其適應螢幕大小
                        const scaleFactor = Math.min(
                            (window.innerWidth * 0.8) / img.naturalWidth,
                            (window.innerHeight * 0.7) / img.naturalHeight
                        );
                        const displayWidth = img.naturalWidth * scaleFactor;
                        const displayHeight = img.naturalHeight * scaleFactor;

                        let initialPieces = [];
                        for (let i = 0; i < rows * cols; i++) {
                            initialPieces.push({
                                id: i,
                                correctPos: i,
                                currentPos: i,
                                // 計算每個拼圖塊在顯示尺寸下的位置
                                x: (i % cols) * (displayWidth / cols),
                                y: Math.floor(i / cols) * (displayHeight / rows),
                            });
                        }

                        // 為滑動拼圖移除最後一塊作為空白格
                        const lastPieceId = rows * cols - 1;
                        const initialEmptySpot = { ...initialPieces[lastPieceId] }; // 複製最後一塊的位置
                        setEmptySpot(initialEmptySpot); // 設定空白格的初始位置

                        // 從拼圖塊中移除最後一塊
                        const actualPieces = initialPieces.slice(0, lastPieceId);

                        // 隨機打亂拼圖
                        const shuffledPieces = shuffleArray(actualPieces);
                        // 更新打亂後拼圖塊的 currentPos
                        setPieces(shuffledPieces.map((piece, index) => ({
                            ...piece,
                            currentPos: index < lastPieceId ? shuffledPieces[index].correctPos : lastPieceId // 保持正確的位置
                        })));
                        
                        setOriginalImageSize({ width: img.naturalWidth, height: img.naturalHeight });
                        setDisplayImageSize({ width: displayWidth, height: displayHeight });
                        setIsLoading(false); // 載入完成，顯示拼圖
                        setIsPuzzleActive(true); // 啟動拼圖互動
                        setMessage("點擊拼圖塊開始遊戲！"); // 載入成功訊息
                    };

                    img.onerror = () => {
                        console.error("圖片載入失敗，請檢查圖片路徑或文件是否損壞。", imageUrl);
                        setMessage("圖片載入失敗，請檢查圖片路徑或文件。");
                        setIsLoading(false);
                    };
                }, [imageUrl, rows, cols]); // 確保在 imageUrl, rows, cols 改變時重新執行

                // 隨機打亂陣列的工具函數
                const shuffleArray = (array) => {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                };

                // 判斷拼圖是否完成
                const isSolved = () => {
                    if (pieces.length === 0) return false;
                    // 對於滑動拼圖，檢查除了空白格以外的所有拼圖塊是否都在正確的位置
                    return pieces.every(piece => piece.currentPos === piece.id);
                };

                // 處理拼圖塊點擊事件
                const handlePieceClick = (clickedPiece) => {
                    if (!isPuzzleActive) return; // 拼圖未啟動，不響應點擊

                    const canMove = (piece, empty) => {
                        const pieceRow = Math.floor(piece.currentPos / cols);
                        const pieceCol = piece.currentPos % cols;
                        const emptyRow = Math.floor(empty.currentPos / cols);
                        const emptyCol = empty.currentPos % cols;

                        // 判斷是否在同一行或同一列，且相鄰
                        const isAdjacentRow = pieceRow === emptyRow && Math.abs(pieceCol - emptyCol) === 1;
                        const isAdjacentCol = pieceCol === emptyCol && Math.abs(pieceRow - emptyRow) === 1;

                        return isAdjacentRow || isAdjacentCol;
                    };

                    if (canMove(clickedPiece, emptySpot)) {
                        setPieces(prevPieces => {
                            const newPieces = prevPieces.map(p =>
                                p.id === clickedPiece.id ? { ...p, currentPos: emptySpot.currentPos } : p
                            );
                            return newPieces;
                        });
                        // 移動空白格到被點擊的拼圖塊的原始位置
                        setEmptySpot({ ...emptySpot, currentPos: clickedPiece.currentPos });
                    }
                };

                useEffect(() => {
                    if (!isLoading && isSolved()) {
                        setMessage("恭喜你！拼圖完成了！");
                        setIsPuzzleActive(false); // 停止互動
                        handleGameComplete('jigsaw-puzzle', games.find(g => g.id === 'jigsaw-puzzle').points);
                        // 這裡可以導向成功頁面
                        navigateTo('success-puzzle');
                    }
                }, [pieces, isLoading]); // 監聽 pieces 和 isLoading 的變化

                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex flex-col items-center justify-center p-4 text-white no-zoom">
                        <h2 className="text-4xl font-bold mb-6 text-yellow-300 drop-shadow-lg">滑動拼圖遊戲</h2>
                        <div className="w-full max-w-lg bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-2xl border-4 border-white text-center flex flex-col items-center">
                            <p className="text-xl mb-4">{message}</p>
                            {isLoading ? (
                                <div className="text-2xl">載入中...</div>
                            ) : (
                                <div
                                    className="relative border-4 border-yellow-300 rounded-lg overflow-hidden shadow-xl"
                                    style={{
                                        width: displayImageSize.width,
                                        height: displayImageSize.height,
                                        aspectRatio: `${displayImageSize.width} / ${displayImageSize.height}`
                                    }}
                                >
                                    {pieces.map(piece => (
                                        <div
                                            key={piece.id}
                                            className={`absolute cursor-pointer puzzle-piece transform ${isPuzzleActive ? 'hover:scale-105' : ''}`}
                                            onClick={() => handlePieceClick(piece)}
                                            style={{
                                                width: displayImageSize.width / cols,
                                                height: displayImageSize.height / rows,
                                                backgroundImage: `url(${imageUrl})`,
                                                backgroundSize: `${displayImageSize.width}px ${displayImageSize.height}px`,
                                                backgroundPosition: `-${piece.x}px -${piece.y}px`,
                                                left: (piece.currentPos % cols) * (displayImageSize.width / cols),
                                                top: Math.floor(piece.currentPos / cols) * (displayImageSize.height / rows),
                                                boxShadow: 'inset 0 0 0 1px rgba(255,255,255,0.3)' // 拼圖塊之間的邊界
                                            }}
                                        />
                                    ))}
                                </div>
                            )}
                            <button
                                onClick={goBack}
                                className="w-full mt-6 bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-3 rounded-lg font-bold shadow-md mobile-button"
                            >
                                🏠 回到主畫面
                            </button>
                        </div>
                    </div>
                );
            };

            // 抽卡遊戲組件 (這裡只提供框架，如果原始有完整邏輯，請替換)
            const GachaGame = () => {
                const [result, setResult] = useState(null);
                const [message, setMessage] = useState("點擊按鈕，試試你的手氣！");
                const [isSpinning, setIsSpinning] = useState(false);

                const rewards = [
                    { name: '謝謝參與', type: 'text', weight: 40 },
                    { name: '10點驚喜點數', type: 'points', value: 10, weight: 30 },
                    { name: '特別禮物 A', type: 'item', weight: 20 },
                    { name: '神秘大獎！', type: 'item', weight: 10 }
                ];

                const weightedRandom = (items) => {
                    let i,
                        weights = [];
                    for (i = 0; i < items.length; i++)
                        weights[i] = items[i].weight + (weights[i - 1] || 0);
                    
                    let random = Math.random() * weights[weights.length - 1];
                    for (i = 0; i < weights.length; i++)
                        if (weights[i] > random)
                            break;
                    return items[i];
                };

                const handleSpin = () => {
                    if (isSpinning) return;
                    setIsSpinning(true);
                    setResult(null);
                    setMessage("轉動中...祝你好運！");

                    setTimeout(() => {
                        const chosenReward = weightedRandom(rewards);
                        setResult(chosenReward);
                        setMessage(`恭喜你抽到了：${chosenReward.name}！`);
                        setIsSpinning(false);

                        // 判斷是否為點數獎勵並增加點數
                        if (chosenReward.type === 'points') {
                            setCurrentPoints(prevPoints => prevPoints + chosenReward.value);
                        }
                        // 如果是遊戲完成並給點數，則像其他遊戲一樣處理
                        // handleGameComplete('gacha-game', games.find(g => g.id === 'gacha-game').points); // 抽卡通常是每次都能抽，而不是完成遊戲
                    }, 2000);
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-600 to-blue-700 flex flex-col items-center justify-center p-4 text-white">
                        <h2 className="text-4xl font-bold mb-6 text-yellow-300 drop-shadow-lg">幸運抽卡遊戲</h2>
                        <div className="w-full max-w-md bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-2xl border-4 border-white text-center">
                            <p className="text-xl mb-6">{message}</p>
                            <div className="mb-6 h-24 flex items-center justify-center text-4xl font-bold text-yellow-200">
                                {result ? result.name : (isSpinning ? '...' : '等待抽獎')}
                            </div>
                            <button
                                onClick={handleSpin}
                                disabled={isSpinning}
                                className={`w-full py-4 px-6 rounded-xl shadow-lg transform transition duration-300 mobile-button font-bold text-white
                                    ${isSpinning ? 'bg-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 hover:scale-105'}`}
                            >
                                {isSpinning ? '轉動中...' : '立即抽卡！'}
                            </button>
                            <button
                                onClick={goBack}
                                className="w-full mt-6 bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-3 rounded-lg font-bold shadow-md mobile-button"
                            >
                                🏠 回到主畫面
                            </button>
                        </div>
                    </div>
                );
            };


            // 成功頁面組件
            const SuccessPage = ({ title, emoji, points, gameId }) => (
                <div className="min-h-screen bg-gradient-to-br from-yellow-400 to-orange-500 flex flex-col items-center justify-center p-4 text-white">
                    <h2 className="text-5xl font-black mb-6 animate-pulse">{emoji} {title} {emoji}</h2>
                    <p className="text-2xl mb-8">你獲得了 {points} 點驚喜點數！</p>
                    <div className="flex space-x-4">
                        <button
                            onClick={() => navigateTo('home')}
                            className="bg-green-500 hover:bg-green-600 text-white px-6 py-4 rounded-lg font-bold shadow-lg mobile-button"
                        >
                            🎉 繼續收集點數
                        </button>
                        {games.some(game => !completedGames[game.id]) && (
                            <button
                                onClick={goBack}
                                className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-4 rounded-lg font-bold shadow-lg mobile-button"
                            >
                                ↩️ 返回遊戲
                            </button>
                        )}
                    </div>
                </div>
            );

            // 根據當前頁面渲染
            const renderPage = () => {
                switch (currentPage) {
                    case 'guess-number':
                        return <GuessNumberGame />;
                    case 'memory-card':
                        return <MemoryCardGame />;
                    case 'jigsaw-puzzle':
                        return <JigsawPuzzleGame />;
                    case 'gacha-game': // 抽卡遊戲頁面
                        return <GachaGame />;
                    case 'success-number':
                        return <SuccessPage title="恭喜過關！" emoji="🎉" points={3} gameId="guess-number" />;
                    case 'success-memory':
                        return <SuccessPage title="記憶達人！" emoji="🎉" points={3} gameId="memory-card" />;
                    case 'success-puzzle':
                        // 修正點數為 5，與 games 列表保持一致
                        return <SuccessPage title="拼圖大師！" emoji="🧩" points={games.find(g => g.id === 'jigsaw-puzzle').points} gameId="jigsaw-puzzle" />;
                    default:
                        return <HomePage />;
                }
            };

            return renderPage();
        };

        ReactDOM.render(<BirthdayGameApp />, document.getElementById('root'));
    </script>
</body>
</html>
