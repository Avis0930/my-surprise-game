<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ Special GAME ğŸŒŸ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }
        .mobile-button {
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .no-zoom {
            touch-action: pan-x pan-y;
        }
        /* å®šç¾©åœ°é¼ å‹•ç•« */
        @keyframes whack-in {
            0% { transform: translateY(100%) scale(0.8); }
            50% { transform: translateY(-10%) scale(1.1); }
            100% { transform: translateY(0) scale(1); }
        }
        @keyframes whack-out {
            0% { transform: translateY(0) scale(1); }
            100% { transform: translateY(100%) scale(0.8); }
        }
        .mole-active {
            animation: whack-in 0.2s forwards;
        }
        .mole-hit {
            animation: whack-out 0.2s forwards;
            filter: grayscale(100%); /* é»æ“Šå¾Œè®Šç° */
        }
        .mole-disappear {
            animation: whack-out 0.2s forwards;
        }

        /* Candy Crush éŠæˆ²æ¨£å¼ */
        .candy-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 2px;
            width: 100%; /* ç¢ºä¿ç¶²æ ¼åœ¨å®¹å™¨å…§å¡«æ»¿ */
            max-width: 300px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œé¿å…éå¤§ */
            margin: 0 auto; /* ç½®ä¸­ */
            aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢ */
            background-color: #8B4513; /* å·§å…‹åŠ›è‰²èƒŒæ™¯ */
            padding: 5px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .candy-tile {
            width: 100%;
            padding-bottom: 100%; /* Make them square */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem; /* ç³–æœè¡¨æƒ…ç¬¦è™Ÿå¤§å° */
            border-radius: 8px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.1); /* æ·ºè‰²èƒŒæ™¯ï¼Œè®“ç³–æœæ›´çªå‡º */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.1s ease-out, opacity 0.2s ease-out;
            user-select: none;
            touch-action: manipulation;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
            /* å„ªåŒ–ï¼šå‘ŠçŸ¥ç€è¦½å™¨é€™äº›å±¬æ€§å°‡æœƒæ”¹è®Š */
            will-change: transform, opacity;
        }
        .candy-tile.selected {
            border: 3px solid #FFD700; /* é»ƒé‡‘é‚Šæ¡†é¸ä¸­ */
            box-shadow: 0 0 15px #FFD700;
        }
        /* å„ªåŒ–ï¼šæ›´å¿«çš„æ¶ˆé™¤å‹•ç•« */
        .candy-tile.clearing {
            animation: fadeOut 0.2s forwards; /* æ¶ˆé™¤æ™‚çš„å‹•ç•«æ™‚é–“ç¸®çŸ­ */
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.2); } /* ç¸®å°æ›´å¤šä»¥åŠ é€Ÿæ¶ˆå¤±æ„Ÿ */
        }
        /* å„ªåŒ–ï¼šç³–æœä¸‹è½å‹•ç•« */
        .candy-tile.falling {
            animation: fallDown 0.2s ease-out forwards;
        }
        @keyframes fallDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .candy-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* æŠ½å¡åœ–ç‰‡æ¨£å¼ */
        /* èª¿æ•´åœ–ç‰‡å°ºå¯¸å’Œé‚Šæ¡† */
        .card-image {
            width: 100%;
            max-width: 320px; /* æ”¾å¤§å¡ç‰‡å°ºå¯¸ */
            height: 320px; /* å›ºå®šé«˜åº¦ï¼Œèˆ‡ max-width ç›¸åŒï¼Œä»¥ä¾¿æ–¼ cover æ•ˆæœ */
            border-radius: 0.75rem; /* åœ“è§’ */
            border: 5px solid; /* é‚Šæ¡† */
            box-shadow: 0 4px 15px rgba(0,0,0,0.4); /* æ›´å¼·çƒˆçš„é™°å½± */
            transition: all 0.3s ease-in-out;
            object-fit: cover; /* è®“åœ–ç‰‡å¡«æ»¿å®¹å™¨ï¼Œå¯èƒ½æœƒè£åˆ‡éƒ¨åˆ†å…§å®¹ */
            aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢ */
        }

        /* ç¨€æœ‰åº¦é‚Šæ¡†é¡è‰² */
        .card-image.ssr { border-color: #FFD700; /* é‡‘è‰² */ }
        .card-image.sr { border-color: #8A2BE2; /* ç´«è‰² */ }
        .card-image.r { border-color: #ADD8E6; /* æ·ºè—è‰² */ }

        /* ç¨€æœ‰åº¦æ¨™ç±¤æ¨£å¼ - å¢å¼·è¦–è¦ºæ•ˆæœ */
        .rarity-tag {
            font-weight: bold;
            padding: 0.4rem 1.2rem; /* å¢åŠ å…§é‚Šè· */
            border-radius: 9999px; /* å…¨åœ“è§’ */
            margin-top: 1.5rem; /* å¢åŠ èˆ‡åœ–ç‰‡çš„é–“è· */
            display: inline-block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* æ›´å¼·çš„é™°å½± */
            font-size: 1.1rem; /* å¢å¤§å­—é«” */
            text-transform: uppercase; /* å¤§å¯« */
            letter-spacing: 1px; /* å¢åŠ å­—è· */
            position: relative; /* ç‚ºå¯èƒ½çš„é€²ä¸€æ­¥ç‰¹æ•ˆåšæº–å‚™ */
            overflow: hidden; /* éš±è—è¶…å‡ºé‚Šç•Œçš„å…§å®¹ */
            transition: all 0.3s ease;
        }
        .rarity-tag.ssr {
            background: linear-gradient(45deg, #FFD700 0%, #FFA500 50%, #FFCC00 100%); /* é‡‘æ©™æ¼¸è®Š */
            color: #8B4513; /* æ·±æ£•è‰²æ–‡å­— */
            text-shadow: 1px 1px 3px rgba(255,255,255,0.7); /* æ›´æ˜é¡¯çš„æ–‡å­—é™°å½± */
            border: 2px solid #FFECB3; /* æ·ºé‡‘é‚Šæ¡† */
        }
        .rarity-tag.sr {
            background: linear-gradient(45deg, #8A2BE2 0%, #EE82EE 50%, #DA70D6 100%); /* ç´«ç²‰æ¼¸è®Š */
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
            border: 2px solid #D8BFD8; /* æ·ºç´«é‚Šæ¡† */
        }
        .rarity-tag.r {
            background: linear-gradient(45deg, #ADD8E6 0%, #87CEEB 50%, #B0E0E6 100%); /* æ·ºè—æ¼¸è®Š */
            color: #333;
            text-shadow: 1px 1px 3px rgba(255,255,255,0.7);
            border: 2px solid #E0FFFF; /* æ·ºè—é‚Šæ¡† */
        }

        /* æŠ½å¡å‹•ç•« */
        @keyframes rotate-in {
            0% { transform: scale(0.5) rotateY(180deg); opacity: 0; }
            100% { transform: scale(1) rotateY(0deg); opacity: 1; }
        }
        .card-enter {
            animation: rotate-in 0.5s forwards;
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const BirthdayGameApp = () => {
            const [currentPoints, setCurrentPoints] = useState(0);
            const [currentPage, setCurrentPage] = useState('home');
            const [gameResults, setGameResults] = useState({});
            // æŠ½å¡ç‹€æ…‹
            const [gameState, setGameState] = useState('ready');
            // æ–°å¢æŠ½å¡çµæœç‹€æ…‹
            const [drawResult, setDrawResult] = useState(null); // { type: 'legendary', url: '...' }
            console.log('æ¸²æŸ“ç‹€æ…‹:', gameState, 'é»æ•¸:', currentPoints);

            const games = [
                { id: 'guess-number', name: '1A2BçŒœæ•¸å­—', points: 3, difficulty: 'ç°¡å–®', emoji: 'ğŸ”¢' },
                { id: 'memory-card', name: 'ç¿»ç‰Œé€£é€£çœ‹', points: 3, difficulty: 'ä¸­ç­‰', emoji: 'ğŸ´' },
                { id: 'whack-a-mole', name: 'æ‰“åœ°é¼ ', points: 4, difficulty: 'ä¸­ç­‰', emoji: 'ğŸ­' }, // æ–°å¢æ‰“åœ°é¼ 
                { id: 'candy-crush', name: 'ç³–æœæ¶ˆæ¶ˆæ¨‚', points: 2, difficulty: 'ç°¡å–®', emoji: 'ğŸ­' },
                // å·²ç§»é™¤æ‹–æ›³æ‹¼åœ–éŠæˆ² { id: 'jigsaw-puzzle', name: 'æ‹–æ›³æ‹¼åœ–', points: 5, difficulty: 'å›°é›£', emoji: 'ğŸ§©' },
            ];
            const completeGame = (gameId, points) => {
                setCurrentPoints(prev => prev + points);
                setGameResults(prev => ({
                    ...prev,
                    [gameId]: (prev[gameId] || 0) + 1
                }));
            };

            // *** START: æŠ½å¡åœ–ç‰‡é…ç½® - å·²æ›´æ–°ç‚º SSR, SR, R ç­‰ç´šèˆ‡æ•¸é‡å»ºè­° ***
            const cardImages = {
                ssr: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr5.jpg',
                    // å¦‚æœæ‚¨æœ‰æ›´å¤š SSR åœ–ç‰‡ï¼Œè«‹åœ¨æ­¤æ·»åŠ 
                ],
                sr: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr5.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr6.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr7.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr8.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr9.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr10.jpg',
                    // å¦‚æœæ‚¨æœ‰æ›´å¤š SR åœ–ç‰‡ï¼Œè«‹åœ¨æ­¤æ·»åŠ 
                ],
                r: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r5.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r6.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r7.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r8.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r9.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r10.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r11.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r12.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r13.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r14.jpg',
                    // å¦‚æœæ‚¨æœ‰æ›´å¤š R åœ–ç‰‡ï¼Œè«‹åœ¨æ­¤æ·»åŠ 
                ]
            };
            // *** END: æŠ½å¡åœ–ç‰‡é…ç½® ***

            // æ‰“åœ°é¼ éŠæˆ²çµ„ä»¶ (ä¸è®Šå‹•)
            const WhackAMoleGame = () => {
                const [score, setScore] = useState(0);
                const [timeLeft, setTimeLeft] = useState(30);
                const [activeHole, setActiveHole] = useState(null); // ç•¶å‰æœ‰åœ°é¼ çš„æ´
                const [gameOver, setGameOver] = useState(false);
                const [gameStarted, setGameStarted] = useState(false);
                const timerRef = useRef(null);
                const moleTimerRef = useRef(null);

                const moles = Array.from({ length: 9 }, (_, i) => i); // 9å€‹æ´

                const startGame = () => {
                    setScore(0);
                    setTimeLeft(30);
                    setActiveHole(null);
                    setGameOver(false);
                    setGameStarted(true);
                    startTimer();
                    showMole();
                };

                const startTimer = () => {
                    timerRef.current = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                clearInterval(timerRef.current);
                                clearInterval(moleTimerRef.current);
                                setGameOver(true);
                                setActiveHole(null);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                };

                const showMole = () => {
                    const randomDelay = Math.random() * (1.2 - 0.8) + 0.8; // 0.8-1.2ç§’å‡ºç¾
                    moleTimerRef.current = setTimeout(() => {
                        let newHole = Math.floor(Math.random() * moles.length);
                        while (newHole === activeHole) { // é¿å…é€£çºŒåœ¨åŒä¸€å€‹æ´
                            newHole = Math.floor(Math.random() * moles.length);
                        }
                        setActiveHole(newHole);

                        const disappearDelay = Math.random() * (2.5 - 1.5) + 1.5; // 1.5-2.5ç§’æ¶ˆå¤±
                        setTimeout(() => {
                            if (activeHole === newHole) { // å¦‚æœé‚„æ²’è¢«æ“Šä¸­
                                setActiveHole(null);
                            }
                            if (!gameOver) {
                                showMole(); // ç¹¼çºŒé¡¯ç¤ºä¸‹ä¸€éš»åœ°é¼ 
                            }
                        }, disappearDelay * 1000);
                    }, randomDelay * 1000);
                };

                const whackMole = (holeIndex) => {
                    if (gameOver || activeHole !== holeIndex) {
                        return;
                    }
                    setScore(prevScore => prevScore + 1);
                    setActiveHole(null); // åœ°é¼ è¢«æ“Šä¸­å¾Œç«‹å³æ¶ˆå¤±
                    
                    // é»æ“Šå¾Œç«‹å³é¡¯ç¤ºä¸‹ä¸€éš»åœ°é¼ ï¼Œä¸ç­‰å¾…æ¶ˆå¤±å‹•ç•«å®Œæˆ
                    if (!gameOver) {
                        clearTimeout(moleTimerRef.current); // æ¸…é™¤ç•¶å‰åœ°é¼ çš„æ¶ˆå¤±è¨ˆæ™‚å™¨
                        showMole();
                    }
                };

                useEffect(() => {
                    return () => {
                        clearInterval(timerRef.current);
                        clearTimeout(moleTimerRef.current);
                    };
                }, []);

                // ä¿®æ­£ useEffect ä¾è³´é …
                useEffect(() => {
                    if (gameOver) {
                        if (score >= 15) {
                            completeGame('whack-a-mole', 4); // æ›´æ–°é»æ•¸ç‚º4
                            setCurrentPage('success-whack-a-mole');
                        }
                    }
                }, [gameOver, score, completeGame, setCurrentPage]); // æ·»åŠ  completeGame å’Œ setCurrentPage

                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-300 via-lime-400 to-emerald-500 p-4 no-zoom flex items-center justify-center">
                        <div className="max-w-md mx-auto text-center w-full">
                            <div className="bg-white/95 backdrop-blur-sm border-4 border-green-500 shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
                                <h2 className="text-center font-black text-xl text-green-700 mb-2">ğŸ”¨ æ‰“åœ°é¼ éŠæˆ²</h2>
                                <p className="text-center text-sm text-gray-600 font-semibold mb-4">
                                    æ“Šä¸­åœ°é¼ ç²å¾—åˆ†æ•¸ï¼Œæ™‚é–“å…§é”åˆ°15åˆ†å³å¯éé—œï¼
                                </p>
                                <div className="flex justify-between items-center mb-4 bg-lime-100 rounded-full px-4 py-2 border-2 border-lime-200">
                                    <div className="text-lg font-bold text-green-700">åˆ†æ•¸: {score}</div>
                                    <div className={`text-xl font-bold ${timeLeft <= 10 && !gameOver ? 'text-red-500 animate-pulse' : 'text-green-700'}`}>
                                        æ™‚é–“: {formatTime(timeLeft)}
                                    </div>
                                </div>

                                {!gameStarted && !gameOver ? (
                                    <button
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-green-500 to-green-700 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                    >
                                        ğŸš€ é–‹å§‹éŠæˆ²
                                    </button>
                                ) : gameOver ? (
                                    <div className="space-y-4">
                                        <div className="text-4xl font-black text-green-700">
                                            {score >= 15 ? 'ğŸ‰ æ­å–œéé—œï¼' : 'ğŸ˜… æ™‚é–“çµæŸï¼'}
                                        </div>
                                        <div className="text-xl font-bold text-gray-700 bg-gray-100 rounded-full px-4 py-2">
                                            æœ€çµ‚åˆ†æ•¸: {score}
                                        </div>
                                        {score < 15 && (
                                            <div className="text-lg font-bold text-red-600 bg-red-100 rounded-full px-4 py-2">
                                                æœªé”åˆ° {15} åˆ†ï¼Œæ²’æœ‰ç²å¾—çå‹µå“¦ï¼
                                            </div>
                                        )}
                                        <button
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                        >
                                            ğŸ”„ å†ç©ä¸€æ¬¡
                                        </button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-3 gap-3 bg-gradient-to-br from-yellow-700 to-orange-800 p-4 rounded-xl border-4 border-yellow-600 shadow-inner">
                                        {moles.map((holeIndex) => (
                                            <div
                                                key={holeIndex}
                                                className="relative w-full aspect-square bg-gradient-to-br from-yellow-900 to-yellow-700 rounded-full flex items-center justify-center overflow-hidden"
                                                style={{ boxShadow: 'inset 0 0 10px rgba(0,0,0,0.5)' }}
                                                onClick={() => whackMole(holeIndex)}
                                            >
                                                {activeHole === holeIndex ? (
                                                    <span className="absolute inset-0 flex items-center justify-center text-6xl cursor-pointer select-none mole-active">
                                                            ğŸ¹
                                                    </span>
                                                ) : (
                                                    <span className="text-4xl text-yellow-600 select-none">ğŸ•³ï¸</span>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                            >
                                ğŸ  å›åˆ°é¦–é 
                            </button>
                        </div>
                    </div>
                );
            };

            // ç³–æœæ¶ˆæ¶ˆæ¨‚éŠæˆ²çµ„ä»¶
            const CandyCrushGame = () => {
                const candies = ['ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ§', 'ğŸ©'];
                const rows = 6;
                const cols = 6;
                const targetScore = 500; 

                // ä½¿ç”¨ state å„²å­˜å¸¶æœ‰ç‹€æ…‹çš„ grid (ä¾‹å¦‚æ˜¯å¦æ­£åœ¨æ¸…é™¤ã€ä¸‹è½)
                const [grid, setGrid] = useState([]);
                const [score, setScore] = useState(0);
                const [timeLeft, setTimeLeft] = useState(30);
                const [gameOver, setGameOver] = useState(false);
                const [gameStarted, setGameStarted] = useState(false);
                const [selectedCandy, setSelectedCandy] = useState(null); // {row, col}
                const gameIntervalRef = useRef(null);

                // ç”Ÿæˆåˆå§‹ç¶²æ ¼
                const generateInitialGrid = () => {
                    const newGrid = Array(rows).fill(null).map(() => Array(cols).fill(null));
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c < cols; c++) {
                            newGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'normal' };
                        }
                    }
                    // ç¢ºä¿åˆå§‹ç¶²æ ¼æ²’æœ‰ç›´æ¥å¯æ¶ˆé™¤çš„çµ„åˆ
                    let hasMatch = true;
                    while (hasMatch) {
                        hasMatch = false;
                        const matches = checkMatches(newGrid);
                        if (matches.length > 0) {
                            hasMatch = true;
                            // é‡æ–°éš¨æ©ŸåŒ–æœ‰åŒ¹é…çš„ç³–æœ
                            matches.forEach(({ r, c }) => {
                                newGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'normal' };
                            });
                        }
                    }
                    return newGrid;
                };

                // æª¢æŸ¥æ˜¯å¦æœ‰é€£ç·šä¸¦è¿”å›æ‰€æœ‰åŒ¹é…çš„ç³–æœä½ç½®
                const checkMatches = (currentGrid) => {
                    const matches = new Set(); // ä½¿ç”¨ Set å„²å­˜ 'r-c' å­—ç¬¦ä¸²ï¼Œé¿å…é‡è¤‡
                
                    // æª¢æŸ¥æ°´å¹³é€£ç·š
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c <= cols - 3; c++) {
                            const candy = currentGrid[r][c].emoji;
                            if (candy && candy === currentGrid[r][c + 1].emoji && candy === currentGrid[r][c + 2].emoji) {
                                // æ‰¾åˆ°è‡³å°‘3å€‹é€£ç·š
                                let lineLength = 3;
                                while (c + lineLength < cols && candy === currentGrid[r][c + lineLength].emoji) {
                                    lineLength++;
                                }
                                for (let i = 0; i < lineLength; i++) {
                                    matches.add(`${r}-${c + i}`);
                                }
                            }
                        }
                    }
                
                    // æª¢æŸ¥å‚ç›´é€£ç·š
                    for (let c = 0; c < cols; c++) {
                        for (let r = 0; r <= rows - 3; r++) {
                            const candy = currentGrid[r][c].emoji;
                            if (candy && candy === currentGrid[r + 1][c].emoji && candy === currentGrid[r + 2][c].emoji) {
                                // æ‰¾åˆ°è‡³å°‘3å€‹é€£ç·š
                                let lineLength = 3;
                                while (r + lineLength < rows && candy === currentGrid[r + lineLength][c].emoji) {
                                    lineLength++;
                                }
                                for (let i = 0; i < lineLength; i++) {
                                    matches.add(`${r + i}-${c}`);
                                }
                            }
                        }
                    }
                    return Array.from(matches).map(pos => {
                        const [r, c] = pos.split('-').map(Number);
                        return { r, c };
                    });
                };
                
                // åŸ·è¡Œæ¶ˆé™¤ã€åˆ†æ•¸è¨ˆç®—ã€ä¸‹è½ã€è£œå……ï¼Œä¸¦éè¿´æª¢æŸ¥é€£æ“Š
                const processMatches = async (initialGrid) => {
                    let currentGrid = JSON.parse(JSON.stringify(initialGrid));
                    let totalScoreFromThisMove = 0;

                    while (true) {
                        const matches = checkMatches(currentGrid);
                        if (matches.length === 0) {
                            break; // æ²’æœ‰å¯æ¶ˆé™¤çš„äº†ï¼ŒçµæŸ
                        }

                        // è¨ˆç®—æœ¬æ¬¡æ¶ˆé™¤çš„åˆ†æ•¸
                        const matchedGroups = groupMatches(matches); // å°‡åŒ¹é…çš„ä½ç½®åˆ†çµ„
                        matchedGroups.forEach(group => {
                            const length = group.length;
                            if (length === 3) totalScoreFromThisMove += 30; // 3é¡†å¾—åˆ†30
                            else if (length === 4) totalScoreFromThisMove += 60; // 4é¡†å¾—åˆ†60
                            else if (length >= 5) totalScoreFromThisMove += 100; // 5é¡†æˆ–æ›´å¤šå¾—åˆ†100
                        });

                        // æ¨™è¨˜è¦æ¶ˆé™¤çš„ç³–æœç‚º nullï¼Œä¸¦æ·»åŠ  'clearing' ç‹€æ…‹
                        matches.forEach(({ r, c }) => {
                            currentGrid[r][c].status = 'clearing';
                        });
                        // ä½¿ç”¨ requestAnimationFrame ç¢ºä¿åœ¨ä¸‹ä¸€å€‹å‹•ç•«å¹€æ›´æ–° UI
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid))); // æ›´æ–° UI é¡¯ç¤ºæ¶ˆé™¤å‹•ç•«
                            resolve();
                        }));

                        await new Promise(resolve => setTimeout(resolve, 200)); // è®“æ¶ˆé™¤å‹•ç•«æ’­æ”¾æ™‚é–“ç¸®çŸ­

                        // å°‡å·²æ¸…é™¤çš„ç³–æœè¨­ç‚º nullï¼Œé–‹å§‹ä¸‹è½
                        matches.forEach(({ r, c }) => {
                            currentGrid[r][c] = { emoji: null, status: 'cleared' }; // æ¨™è¨˜ç‚º cleared
                        });

                        // ä¸‹è½
                        for (let c = 0; c < cols; c++) {
                            let writeRow = rows - 1;
                            for (let r = rows - 1; r >= 0; r--) {
                                if (currentGrid[r][c].emoji !== null) {
                                    currentGrid[writeRow][c] = currentGrid[r][c];
                                    writeRow--;
                                }
                            }
                            for (let r = writeRow; r >= 0; r--) {
                                currentGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'falling' };
                            }
                        }
                        
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid))); // æ›´æ–° UI é¡¯ç¤ºä¸‹è½å’Œè£œå……
                            resolve();
                        }));

                        await new Promise(resolve => setTimeout(resolve, 200)); // è®“ä¸‹è½å‹•ç•«æ’­æ”¾æ™‚é–“ç¸®çŸ­

                        // å°‡æ‰€æœ‰ç³–æœç‹€æ…‹æ¢å¾©æ­£å¸¸
                        for (let r = 0; r < rows; r++) {
                            for (let c = 0; c < cols; c++) {
                                currentGrid[r][c].status = 'normal';
                            }
                        }
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid))); // æ›´æ–° UI é¡¯ç¤ºæœ€çµ‚ç‹€æ…‹
                            resolve();
                        }));

                        // æª¢æŸ¥æ˜¯å¦æœ‰æ–°çš„é€£æ“Šï¼Œå¦‚æœæœ‰å‰‡ç¹¼çºŒè¿´åœˆ
                    }
                    setScore(s => s + totalScoreFromThisMove); // å°‡ç¸½åˆ†åŠ åˆ°éŠæˆ²åˆ†æ•¸
                };


                // è¼”åŠ©å‡½æ•¸ï¼šå°‡åŒ¹é…çš„å–®å€‹ä½ç½®åˆ†çµ„ç‚ºå¯¦éš›çš„é€£ç·š
                const groupMatches = (matches) => {
                    const visited = new Set();
                    const groups = [];

                    matches.forEach(match => {
                        const { r, c } = match;
                        if (!visited.has(`${r}-${c}`)) {
                            const currentGroup = [];
                            const queue = [{ r, c }];
                            visited.add(`${r}-${c}`);
                            
                            while (queue.length > 0) {
                                const { r: currR, c: currC } = queue.shift();
                                currentGroup.push({ r: currR, c: currC });

                                const directions = [
                                    [-1, 0], [1, 0], [0, -1], [0, 1] // Up, Down, Left, Right
                                ];

                                for (const [dr, dc] of directions) {
                                    const newR = currR + dr;
                                    const newC = currC + dc;

                                    if (
                                        matches.some(m => m.r === newR && m.c === newC) && // æ˜¯åŒ¹é…çš„ä¸€éƒ¨åˆ†
                                        !visited.has(`${newR}-${newC}`)
                                    ) {
                                        visited.add(`${newR}-${newC}`);
                                        queue.push({ r: newR, c: newC });
                                    }
                                }
                            }
                            groups.push(currentGroup);
                        }
                    });
                    return groups;
                };


                const startGame = () => {
                    setScore(0);
                    setTimeLeft(30);
                    setGameOver(false);
                    setGameStarted(true);
                    setSelectedCandy(null);
                    const initialGrid = generateInitialGrid();
                    setGrid(initialGrid);

                    clearInterval(gameIntervalRef.current);
                    gameIntervalRef.current = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                clearInterval(gameIntervalRef.current);
                                setGameOver(true);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                };

                // ä¿®æ­£ useEffect ä¾è³´é …
                useEffect(() => {
                    if (gameOver) {
                        clearInterval(gameIntervalRef.current);
                        if (score >= targetScore) {
                            completeGame('candy-crush', 5); 
                            setCurrentPage('success-candy-crush');
                        }
                    }
                }, [gameOver, score, targetScore, completeGame, setCurrentPage]); // æ·»åŠ æ‰€æœ‰å¤–éƒ¨ä¾è³´é …

                useEffect(() => {
                    return () => clearInterval(gameIntervalRef.current);
                }, []); // é€™è£¡çš„ä¾è³´é …æ˜¯ç©ºçš„ï¼Œå› ç‚ºåªåœ¨çµ„ä»¶å¸è¼‰æ™‚åŸ·è¡Œ

                const handleCandyClick = async (r, c) => {
                    if (gameOver || !gameStarted) return;

                    if (selectedCandy) {
                        // ç¬¬äºŒæ¬¡é»æ“Š
                        const prevR = selectedCandy.r;
                        const prevC = selectedCandy.c;

                        // æª¢æŸ¥æ˜¯å¦ç‚ºç›¸é„°ç³–æœ
                        const isAdjacent = (
                            (Math.abs(r - prevR) === 1 && c === prevC) ||
                            (Math.abs(c - prevC) === 1 && r === prevR)
                        );

                        if (isAdjacent) {
                            const newGrid = JSON.parse(JSON.stringify(grid));
                            // åœ¨æ–°çš„è¤‡è£½ç¶²æ ¼ä¸Šäº¤æ›
                            [newGrid[r][c].emoji, newGrid[prevR][prevC].emoji] = [newGrid[prevR][prevC].emoji, newGrid[r][c].emoji];
                            
                            // ç«‹å³æ›´æ–° UI é¡¯ç¤ºäº¤æ›
                            await new Promise(resolve => requestAnimationFrame(() => {
                                setGrid(newGrid);
                                resolve();
                            }));
                            
                            // æª¢æŸ¥äº¤æ›å¾Œæ˜¯å¦æœ‰é€£ç·š
                            const hasMatch = checkMatches(newGrid).length > 0;
                            if (hasMatch) {
                                // æœ‰é€£ç·šï¼Œæ¶ˆé™¤ä¸¦è£œå…… (ç­‰å¾… processMatches å®Œæˆ)
                                await processMatches(newGrid); 
                            } else {
                                // æ²’æœ‰é€£ç·šï¼Œæ›å›ä¾†
                                await new Promise(resolve => setTimeout(resolve, 200)); // çµ¦ä¸€é»æ™‚é–“è®“ç©å®¶çœ‹åˆ°äº¤æ›ä½†æ²’æ¶ˆé™¤
                                [newGrid[r][c].emoji, newGrid[prevR][prevC].emoji] = [newGrid[prevR][prevC].emoji, newGrid[r][c].emoji]; // æ›å›ä¾†
                                await new Promise(resolve => requestAnimationFrame(() => {
                                    setGrid(newGrid);
                                    resolve();
                                }));
                            }
                        }
                        setSelectedCandy(null); // æ¸…é™¤é¸å–
                    } else {
                        // ç¬¬ä¸€æ¬¡é»æ“Š
                        setSelectedCandy({ r, c });
                    }
                };

                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-300 via-orange-400 to-yellow-500 p-4 no-zoom flex items-center justify-center">
                        <div className="max-w-md mx-auto text-center w-full">
                            <div className="bg-white/95 backdrop-blur-sm border-4 border-orange-500 shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
                                <h2 className="text-center font-black text-xl text-orange-700 mb-2">ğŸ¬ ç³–æœæ¶ˆæ¶ˆæ¨‚</h2>
                                <p className="text-center text-sm text-gray-600 font-semibold mb-4">
                                    äº¤æ›ç³–æœï¼Œé”æˆ3å€‹ä»¥ä¸Šé€£ç·šæ¶ˆé™¤ï¼ç›®æ¨™åˆ†æ•¸ {targetScore}ï¼
                                </p>
                                <div className="flex justify-between items-center mb-4 bg-yellow-100 rounded-full px-4 py-2 border-2 border-yellow-200">
                                    <div className="text-lg font-bold text-orange-700">åˆ†æ•¸: {score}</div>
                                    <div className={`text-xl font-bold ${timeLeft <= 10 && !gameOver ? 'text-red-500 animate-pulse' : 'text-orange-700'}`}>
                                        æ™‚é–“: {formatTime(timeLeft)}
                                    </div>
                                </div>

                                {!gameStarted && !gameOver ? (
                                    <button
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-orange-500 to-orange-700 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                    >
                                        ğŸš€ é–‹å§‹éŠæˆ²
                                    </button>
                                ) : gameOver ? (
                                    <div className="space-y-4">
                                        <div className="text-4xl font-black text-orange-700">
                                            {score >= targetScore ? 'ğŸ‰ æ­å–œéé—œï¼' : 'ğŸ˜… æ™‚é–“çµæŸï¼'}
                                        </div>
                                        <div className="text-xl font-bold text-gray-700 bg-gray-100 rounded-full px-4 py-2">
                                            æœ€çµ‚åˆ†æ•¸: {score}
                                        </div>
                                        {score < targetScore && (
                                            <div className="text-lg font-bold text-red-600 bg-red-100 rounded-full px-4 py-2">
                                                æœªé”åˆ° {targetScore} åˆ†ï¼Œæ²’æœ‰ç²å¾—çå‹µå“¦ï¼
                                            </div>
                                        )}
                                        <button
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                        >
                                            ğŸ”„ å†ç©ä¸€æ¬¡
                                        </button>
                                    </div>
                                ) : (
                                    <div className="candy-grid">
                                        {grid.map((row, rIdx) =>
                                            row.map((candyData, cIdx) => (
                                                <div
                                                    key={`${rIdx}-${cIdx}`}
                                                    className={`candy-tile ${selectedCandy?.r === rIdx && selectedCandy?.c === cIdx ? 'selected' : ''} ${candyData.status === 'clearing' ? 'clearing' : ''} ${candyData.status === 'falling' ? 'falling' : ''}`}
                                                    onClick={() => handleCandyClick(rIdx, cIdx)}
                                                >
                                                    <span className="candy-content">{candyData.emoji}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                            >
                                ğŸ  å›åˆ°é¦–é 
                            </button>
                        </div>
                    </div>
                );
            };

            // å·²ç§»é™¤æ‹–æ›³æ‹¼åœ–éŠæˆ²
            // const JigsawPuzzleGame = () => { /* ... (æ­¤è™•åŸæ‹¼åœ–éŠæˆ²ä»£ç¢¼å·²è¢«ç§»é™¤) ... */ };

            // æŠ½å¡æ©Ÿåˆ¶
            const addPoints = () => {
                setCurrentPoints(p => p + 10);
                setGameState('ready');
                console.log('+10é»ï¼Œé‡ç½®ç‚ºready');
            };

            const drawCard = () => {
                if (currentPoints < 5 || gameState !== 'ready') return;
                setCurrentPoints(p => p - 5);
                setGameState('drawing');
                console.log('é–‹å§‹æŠ½å¡ï¼Œç‹€æ…‹->drawing');
                
                setTimeout(() => {
                    // æ ¹æ“šæŠ½å¡çµæœè¨­å®š drawResult (éš¨æ©Ÿé¸ä¸€å¼µåœ–ç‰‡)
                    const rarityRoll = Math.random();
                    let chosenCardUrl = null;
                    let chosenType = '';

                    // SSR: 20% (0.0 - 0.2), SR: 30% (0.2 - 0.5), R: 50% (0.5 - 1.0)
                    if (rarityRoll < 0.2) { // 20% for SSR
                        chosenType = 'ssr';
                        chosenCardUrl = cardImages.ssr[Math.floor(Math.random() * cardImages.ssr.length)];
                    } else if (rarityRoll < 0.5) { // 30% for SR (0.2 + 0.3 = 0.5)
                        chosenType = 'sr';
                        chosenCardUrl = cardImages.sr[Math.floor(Math.random() * cardImages.sr.length)];
                    } else { // 50% for R
                        chosenType = 'r';
                        chosenCardUrl = cardImages.r[Math.floor(Math.random() * cardImages.r.length)];
                    }
                    
                    setDrawResult({ type: chosenType, url: chosenCardUrl });
                    setGameState('result');
                    console.log('è¨ˆæ™‚å™¨åŸ·è¡Œï¼Œç‹€æ…‹->result');
                }, 2000);
            };

            const resetGame = () => {
                setGameState('ready');
                console.log('é‡ç½®ï¼Œç‹€æ…‹->ready');
                setDrawResult(null); // é‡ç½®æŠ½å¡çµæœ
            };

            // é¦–é 
            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-cyan-300 via-purple-400 to-pink-400 p-4 no-zoom">
                    <div className="max-w-sm mx-auto">
                        <div className="text-center mb-6">
                            <div className="bg-white/90 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-4 border-white">
                                <h1 className="text-2xl sm:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500 mb-2">
                                    Special GAME
                                </h1>
                                <p className="text-purple-700 font-semibold text-sm">å®ŒæˆéŠæˆ²ç²å¾—é»æ•¸ï¼Œé›†æ»¿5é»æŠ½é©šå–œå¡ç‰‡ï¼</p>
                                <div className="flex justify-center space-x-2 mt-3">
                                    <span className="text-2xl">ğŸ’–</span>
                                    <span className="text-2xl">ğŸŒˆ</span>
                                    <span className="text-2xl">âœ¨</span>
                                </div>
                            </div>
                        </div>

                        {/* æ§åˆ¶æŒ‰éˆ• */}
                        <div className="fixed top-4 left-4 space-y-2">
                            <button onClick={addPoints} className="bg-red-600 text-white px-4 py-2 rounded font-bold">
                                +10é»
                            </button>
                            <button onClick={resetGame} className="bg-gray-600 text-white px-4 py-2 rounded font-bold">
                                é‡ç½®
                            </button>
                        </div>

                        {/* é»æ•¸é¡¯ç¤º */}
                        <div className="mb-6 bg-gradient-to-r from-yellow-300 to-orange-300 border-4 border-white shadow-xl rounded-2xl p-6 text-center">
                            <div className="text-2xl font-black text-white mb-2 drop-shadow-lg">
                                â­ é»æ•¸: {currentPoints} â­
                            </div>
                            <div className="text-base font-bold text-purple-800 bg-white/80 rounded-full px-4 py-1">
                                {Math.floor(currentPoints / 5)} æ¬¡æŠ½å¡æ©Ÿæœƒ ğŸ´
                            </div>
                        </div>

                        {/* æŠ½å¡å€åŸŸ */}
                        <div className="bg-gradient-to-r from-yellow-300 via-pink-300 to-purple-300 border-4 border-white rounded-2xl p-6 mb-6">
                            {/* START: æŠ½å¡å€æ¨™é¡Œèª¿æ•´ */}
                            <h3 className="font-black text-xl mb-4 text-white text-center">âœ¨ æ‚¨çš„å¡ç‰‡ âœ¨</h3>
                            {/* END: æŠ½å¡å€æ¨™é¡Œèª¿æ•´ */}
                            
                            <div className="text-center">
                                {/* READY ç‹€æ…‹ */}
                                {gameState === 'ready' && (
                                    <div>
                                        {currentPoints >= 5 ? (
                                            <button
                                                onClick={drawCard}
                                                className="w-full bg-cyan-500 text-white px-6 py-4 rounded-full text-lg font-black hover:bg-cyan-600"
                                            >
                                                ğŸ´ æŠ½å¡ç‰‡ï¼(-5é») âœ¨
                                            </button>
                                        ) : (
                                            <div className="bg-white/90 rounded-full px-4 py-3">
                                                <p className="text-purple-700 font-bold">é‚„éœ€è¦ {5 - currentPoints} é»æ‰èƒ½æŠ½å¡ âœ¨</p>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* DRAWING ç‹€æ…‹ */}
                                {gameState === 'drawing' && (
                                    <div className="space-y-4">
                                        <div className="text-6xl animate-spin">ğŸ´</div>
                                        <div className="text-white font-bold text-xl animate-pulse">æŠ½å¡ä¸­...</div>
                                    </div>
                                )}

                                {/* RESULT ç‹€æ…‹ - å„ªåŒ–æ’ç‰ˆå’Œæ–‡å­— */}
                                {gameState === 'result' && drawResult && (
                                    <div className="flex flex-col items-center justify-center space-y-4 card-enter">
                                        {drawResult.url && (
                                            <img
                                                src={drawResult.url}
                                                alt={drawResult.type}
                                                className={`card-image ${drawResult.type}`}
                                            />
                                        )}
                                        {/* START: ç¨€æœ‰åº¦æ¨™ç±¤å„ªåŒ– */}
                                        <div className={`rarity-tag ${drawResult.type}`}>
                                            {drawResult.type.toUpperCase()}
                                        </div>
                                        {/* END: ç¨€æœ‰åº¦æ¨™ç±¤å„ªåŒ– */}
                                        
                                        <button
                                            onClick={resetGame}
                                            className="w-full bg-purple-500 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-600"
                                        >
                                            ç¹¼çºŒéŠæˆ² ğŸ’«
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* éŠæˆ²åˆ—è¡¨ */}
                        <div className="space-y-4">
                            {games.map((game, index) => {
                                const gradients = [
                                    'from-pink-400 to-rose-400',
                                    'from-cyan-400 to-blue-400', 
                                    'from-purple-400 to-violet-400',
                                    'from-green-400 to-emerald-400'
                                ];
                                return (
                                    <div key={game.id} className={`bg-gradient-to-r ${gradients[index % gradients.length]} border-4 border-white shadow-xl rounded-2xl`}>
                                        <div className="p-4">
                                            <div className="flex justify-between items-center">
                                                <div className="flex-1">
                                                    <h3 className="font-black text-lg text-white drop-shadow-lg">
                                                        {game.emoji} {game.name}
                                                    </h3>
                                                    <p className="text-sm text-white/90 font-semibold">
                                                        {game.difficulty} | {game.points}é» â­
                                                    </p>
                                                    {gameResults[game.id] && (
                                                        <p className="text-sm text-yellow-200 font-bold">
                                                            ğŸ‰ å®Œæˆ {gameResults[game.id]} æ¬¡
                                                        </p>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => setCurrentPage(game.id)}
                                                    className="mobile-button bg-white text-purple-700 px-4 py-2 rounded-full font-black hover:bg-yellow-300 transition-all shadow-lg text-sm"
                                                >
                                                    START! ğŸ’«
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
            // çŒœæ•¸å­—éŠæˆ²
            const GuessNumberGame = () => {
                const [targetNumber, setTargetNumber] = useState('');
                const [guess, setGuess] = useState('');
                const [history, setHistory] = useState([]);
                const [attempts, setAttempts] = useState(0);
                const [gameOver, setGameOver] = useState(false);
                
                useEffect(() => {
                    resetNumberGame(); // ç¢ºä¿æ¯æ¬¡é€²å…¥éŠæˆ²éƒ½åˆå§‹åŒ–
                }, []); // ç©ºä¾è³´é™£åˆ—è¡¨ç¤ºåªåœ¨çµ„ä»¶ mount æ™‚åŸ·è¡Œä¸€æ¬¡
                
                const generateNewTargetNumber = () => {
                    const digits = [];
                    while (digits.length < 3) {
                        const digit = Math.floor(Math.random() * 10).toString();
                        if (!digits.includes(digit)) {
                            digits.push(digit);
                        }
                    }
                    return digits.join('');
                };

                const checkGuess = () => {
                    if (guess.length !== 3 || new Set(guess).size !== 3) {
                        alert('è«‹è¼¸å…¥3ä½ä¸é‡è¤‡æ•¸å­—ï¼');
                        return;
                    }

                    let a = 0, b = 0;
                    for (let i = 0; i < 3; i++) {
                        if (guess[i] === targetNumber[i]) {
                            a++;
                        } else if (targetNumber.includes(guess[i])) {
                            b++;
                        }
                    }

                    const result = `${guess} - ${a}A${b}B`;
                    setHistory([result, ...history]);
                    setAttempts(attempts + 1);

                    if (a === 3) {
                        completeGame('guess-number', 3);
                        setCurrentPage('success-number');
                        return;
                    } else if (attempts + 1 >= 10) {
                        setGameOver(true);
                    }

                    setGuess('');
                };

                // ä¿®æ­£ resetNumberGame ä¾è³´é …
                const resetNumberGame = () => {
                    setGameOver(false);
                    setHistory([]);
                    setGuess('');
                    setAttempts(0);
                    setTargetNumber(generateNewTargetNumber());
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-cyan-400 via-purple-500 to-pink-500 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-blue-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">ğŸ”¢ æ•¸å­—éŠæˆ²</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        çŒœå‡º3ä½ä¸é‡è¤‡æ•¸å­—ï¼A=ä½ç½®å’Œæ•¸å­—éƒ½å°ï¼ŒB=æ•¸å­—å°ä½†ä½ç½®éŒ¯ âœ¨
                                    </p>
                                    <p className="text-center text-xs text-white/80 mt-1">
                                        å‰©é¤˜æ©Ÿæœƒ: {10 - attempts} æ¬¡
                                    </p>
                                </div>
                                <div className="p-6">
                                    {!gameOver ? (
                                        <div className="space-y-4">
                                            <div className="space-y-3">
                                                <input
                                                    type="tel"
                                                    value={guess}
                                                    onChange={(e) => setGuess(e.target.value.replace(/\D/g, '').slice(0, 3))}
                                                    placeholder="è¼¸å…¥3ä½æ•¸å­—"
                                                    className="w-full p-4 border-4 border-purple-300 rounded-full text-center text-xl font-bold focus:border-pink-400 focus:outline-none bg-white text-gray-800"
                                                    maxLength={3}
                                                />
                                                <button
                                                    onClick={checkGuess}
                                                    className="w-full bg-gradient-to-r from-cyan-400 to-blue-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-2 border-white"
                                                >
                                                    çŒœæ¸¬! ğŸ’«
                                                </button>
                                            </div>
                                            
                                            <div className="max-h-48 overflow-y-auto space-y-2">
                                                {history.map((result, index) => (
                                                    <div key={index} className="p-3 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full text-center font-bold text-purple-700 border-2 border-purple-200">
                                                        {result}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">ğŸ˜… éŠæˆ²çµæŸ</div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                ç­”æ¡ˆæ˜¯: {targetNumber}
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">âŒ éŠæˆ²å¤±æ•—ï¼æœªç²å¾—é»æ•¸</div>
                                            <button
                                                onClick={resetNumberGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                å†æŒ‘æˆ°ä¸€æ¬¡! ğŸ’ª
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                å›åˆ°é¦–é  ğŸ 
                            </button>
                        </div>
                    </div>
                );
            };

            // ç¿»ç‰Œé€£é€£çœ‹éŠæˆ²
            const MemoryCardGame = () => {
                const [cards, setCards] = useState([]);
                const [flippedCards, setFlippedCards] = useState([]);
                const [matchedCards, setMatchedCards] = useState([]);
                const [gameOver, setGameOver] = useState(false);
                const [timeLeft, setTimeLeft] = useState(60);
                const [timerActive, setTimerActive] = useState(false);

                const emojis = ['ğŸ’–', 'ğŸŒˆ', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ‰', 'ğŸˆ', 'ğŸ¦„'];
                
                useEffect(() => {
                    initializeGame();
                }, []); // åˆå§‹åªåŸ·è¡Œä¸€æ¬¡

                // ä¿®æ­£ useEffect ä¾è³´é …
                useEffect(() => {
                    let interval = null;
                    if (timerActive && timeLeft > 0 && !gameOver) {
                        interval = setInterval(() => {
                            setTimeLeft(timeLeft => {
                                if (timeLeft <= 1) {
                                    setGameOver(true);
                                    setTimerActive(false);
                                    return 0;
                                }
                                return timeLeft - 1;
                            });
                        }, 1000);
                    } else if (timeLeft === 0 && !gameOver) { // æ™‚é–“çµæŸæ™‚è§¸ç™¼éŠæˆ²çµæŸ
                        setGameOver(true);
                        setTimerActive(false);
                    }
                    return () => clearInterval(interval);
                }, [timerActive, timeLeft, gameOver]); // æ·»åŠ æ‰€æœ‰å¤–éƒ¨ä¾è³´é …
                
                // ä¿®æ­£ initializeGame ä¾è³´é …
                const initializeGame = () => {
                    const gameCards = [...emojis, ...emojis].map((emoji, index) => ({
                        id: index,
                        emoji
                    }));
                    
                    for (let i = gameCards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [gameCards[i], gameCards[j]] = [gameCards[j], gameCards[i]];
                    }
                    
                    setCards(gameCards);
                    setFlippedCards([]);
                    setMatchedCards([]);
                    setGameOver(false);
                    setTimeLeft(60);
                    setTimerActive(true);
                };

                // ä¿®æ­£ flipCard ä¾è³´é …
                const flipCard = (cardId) => {
                    if (gameOver || flippedCards.length === 2 || flippedCards.includes(cardId) || matchedCards.includes(cardId)) {
                        return;
                    }

                    const newFlipped = [...flippedCards, cardId];
                    setFlippedCards(newFlipped);

                    if (newFlipped.length === 2) {
                        const [first, second] = newFlipped;
                        const firstCard = cards.find(c => c.id === first);
                        const secondCard = cards.find(c => c.id === second);
                        if (firstCard && secondCard && firstCard.emoji === secondCard.emoji) {
                            const newMatched = [...matchedCards, first, second];
                            setMatchedCards(newMatched);
                            
                            if (newMatched.length === cards.length) {
                                completeGame('memory-card', 3);
                                setTimerActive(false);
                                setCurrentPage('success-memory');
                                return;
                            }
                        }

                        setTimeout(() => setFlippedCards([]), 1000);
                    }
                };
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-400 via-purple-500 to-cyan-400 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-pink-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">ğŸ´ è¨˜æ†¶éŠæˆ²</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        ç¿»é–‹ç›¸åŒçš„å¡ç‰‡é€²è¡Œé…å°ï¼âœ¨
                                    </p>
                                    <div className="text-center mt-2">
                                        <span className={`text-lg font-black ${timeLeft <= 10 ? 'text-red-200 animate-pulse' : 'text-white'}`}>
                                            â° {formatTime(timeLeft)}
                                        </span>
                                    </div>
                                </div>
                                <div className="p-6">
                                    {!gameOver && matchedCards.length < cards.length ? (
                                        <div className="grid grid-cols-4 gap-2">
                                            {cards.map((card) => (
                                                <button
                                                    key={card.id}
                                                    onClick={() => flipCard(card.id)}
                                                    className={`aspect-square text-2xl rounded-xl transition-all duration-300 border-2 border-white shadow-lg ${
                                                        flippedCards.includes(card.id) || matchedCards.includes(card.id)
                                                        ? 'bg-gradient-to-r from-yellow-200 to-pink-200 shadow-xl'
                                                            : 'bg-gradient-to-r from-purple-400 to-pink-400 hover:from-purple-500 hover:to-pink-500'
                                                    } ${matchedCards.includes(card.id) ? 'opacity-60' : ''}`}
                                                >
                                                    {flippedCards.includes(card.id) || matchedCards.includes(card.id) ? card.emoji : 'ğŸ’«'}
                                                </button>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">
                                                {matchedCards.length === cards.length ? 'ğŸ‰ æ­å–œéé—œï¼' : 'â° æ™‚é–“åˆ°äº†ï¼'}
                                            </div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                å·²é…å°: {matchedCards.length / 2} / 8 çµ„
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">
                                                {matchedCards.length === cards.length ? 'ç²å¾—çå‹µï¼' : 'âŒ éŠæˆ²å¤±æ•—ï¼æœªç²å¾—é»æ•¸'}
                                            </div>
                                            <button
                                                onClick={initializeGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                å†æŒ‘æˆ°ä¸€æ¬¡! ğŸ’ª
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                å›åˆ°é¦–é  ğŸ 
                            </button>
                        </div>
                    </div>
                );
            };

            // æˆåŠŸé é¢çµ„ä»¶
            const SuccessPage = ({ title, emoji, points, gameId }) => (
                <div className="min-h-screen bg-gradient-to-br from-green-300 via-emerald-400 to-teal-500 p-4 flex items-center justify-center no-zoom">
                    <div className="max-w-sm mx-auto text-center">
                        <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-8 shadow-2xl border-4 border-white">
                            <div className="text-6xl mb-4 animate-bounce">{emoji}</div>
                            <h2 className="text-3xl font-black text-green-700 mb-4">{title}</h2>
                            <div className="space-y-3 mb-6">
                                <div className="text-xl font-black text-green-600 bg-yellow-200 rounded-full px-6 py-3 animate-pulse">
                                    âœ… ç²å¾— {points} é»æ•¸ï¼â­
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button
                                    onClick={() => setCurrentPage(gameId)}
                                    className="mobile-button w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    ğŸ® å†ç©ä¸€æ¬¡
                                </button>
                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className="mobile-button w-full bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    ğŸ  å›åˆ°ä¸»ç•«é¢
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // æ ¹æ“šç•¶å‰é é¢æ¸²æŸ“
            const renderPage = () => {
                switch (currentPage) {
                    case 'guess-number':
                        return <GuessNumberGame />;
                    case 'memory-card':
                        return <MemoryCardGame />;
                    case 'whack-a-mole': // æ‰“åœ°é¼ éŠæˆ²
                        return <WhackAMoleGame />;
                    case 'candy-crush': // ç³–æœæ¶ˆæ¶ˆæ¨‚
                        return <CandyCrushGame />;
                    // å·²ç§»é™¤æ‹–æ›³æ‹¼åœ–éŠæˆ² case 'jigsaw-puzzle':
                    // å·²ç§»é™¤æ‹–æ›³æ‹¼åœ–éŠæˆ²    return <JigsawPuzzleGame />;
                    case 'success-number':
                        return <SuccessPage title="æ­å–œéé—œï¼" emoji="ğŸ‰" points={3} gameId="guess-number" />;
                    case 'success-memory':
                        return <SuccessPage title="è¨˜æ†¶é”äººï¼" emoji="ğŸ‰" points={3} gameId="memory-card" />;
                    case 'success-whack-a-mole': // æ‰“åœ°é¼ æˆåŠŸé é¢
                        return <SuccessPage title="åœ°é¼ å‰‹æ˜Ÿï¼" emoji="ğŸ”¨" points={4} gameId="whack-a-mole" />;
                    case 'success-candy-crush': // ç³–æœæ¶ˆæ¶ˆæ¨‚æˆåŠŸé é¢
                        return <SuccessPage title="ç”œé»å¤§å¸«ï¼" emoji="ğŸ¬" points={5} gameId="candy-crush" />;
                    // å·²ç§»é™¤æ‹–æ›³æ‹¼åœ–éŠæˆ² case 'success-puzzle':
                    // å·²ç§»é™¤æ‹–æ›³æ‹¼åœ–éŠæˆ²    return <SuccessPage title="æ‹¼åœ–å¤§å¸«ï¼" emoji="ğŸ§©" points={5} gameId="jigsaw-puzzle" />;
                    default:
                        return <HomePage />;
                }
            };

            return renderPage();
        };

        ReactDOM.render(<BirthdayGameApp />, document.getElementById('root'));
    </script>
</body>
</html>
