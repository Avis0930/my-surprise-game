<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Special GAME 🌟</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            background-color: #f0f0f0; /* Add a fallback body background */
        }
        .mobile-button {
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .no-zoom {
            touch-action: pan-x pan-y;
        }
        /* 定義地鼠動畫 */
        @keyframes whack-in {
            0% { transform: translateY(100%) scale(0.8); }
            50% { transform: translateY(-10%) scale(1.1); }
            100% { transform: translateY(0) scale(1); }
        }
        @keyframes whack-out {
            0% { transform: translateY(0) scale(1); }
            100% { transform: translateY(100%) scale(0.8); }
        }
        .mole-active {
            animation: whack-in 0.2s forwards;
        }
        .mole-hit {
            animation: whack-out 0.2s forwards;
            filter: grayscale(100%); /* 點擊後變灰 */
        }
        .mole-disappear {
            animation: whack-out 0.2s forwards;
        }

        /* Candy Crush 遊戲樣式 */
        .candy-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 2px;
            width: 100%; /* 確保網格在容器內填滿 */
            max-width: 300px; /* 限制最大寬度，避免過大 */
            margin: 0 auto; /* 置中 */
            aspect-ratio: 1 / 1; /* 保持正方形 */
            background-color: #8B4513; /* 巧克力色背景 */
            padding: 5px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .candy-tile {
            width: 100%;
            padding-bottom: 100%; /* Make them square */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.1); /* 淺色背景，讓糖果更突出 */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.1s ease-out, opacity 0.2s ease-out;
            user-select: none;
            touch-action: manipulation;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
            will-change: transform, opacity;
            overflow: hidden;
        }
        .candy-tile.selected {
            border: 3px solid #FFD700; /* 黃金邊框選中 */
            box-shadow: 0 0 15px #FFD700;
        }
        .candy-tile.clearing {
            animation: fadeOut 0.2s forwards; /* 消除時的動畫時間縮短 */
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.2); } /* 縮小更多以加速消失感 */
        }
        .candy-tile.falling {
            animation: fallDown 0.2s ease-out forwards;
        }
        @keyframes fallDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .candy-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* 調整糖果表情符號的大小 */
            font-size: 2.5rem; /* 增大糖果表情符號大小 */
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 抽卡圖片樣式 */
        .card-image {
            width: 100%;
            max-width: 320px;
            height: 320px;
            border-radius: 0.75rem;
            border: 5px solid;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            transition: all 0.3s ease-in-out;
            object-fit: cover;
            aspect-ratio: 1 / 1;
            position: relative; /* For pseudo-elements and overlays */
            overflow: hidden; /* For shine effect */
            /* Ensure smooth animations */
            will-change: transform, box-shadow, border-color;
        }

        /* 稀有度邊框顏色 (與標籤顏色呼應) */
        .card-image.sss { border-color: #FFD700; } /* SSS 邊框初始為金色，動畫中變彩虹 */
        .card-image.ssr { border-color: #FFD700; } /* SSR 邊框初始為金色 */
        .card-image.sr { border-color: #BA55D3; } /* SR 邊框初始為紫色 */
        .card-image.r { border-color: #87CEEB; } /* R 邊框初始為淺藍色 */


        /* 稀有度標籤樣式 - 增強視覺效果 */
        .rarity-tag {
            font-weight: bold;
            /* 調整 padding 以優化鑽石形狀的視覺比例 */
            padding: 0.7rem 1.2rem; /* 垂直增加，水平略減，讓鑽石更飽滿 */
            margin-top: 1.5rem;
            display: inline-flex; /* 使用 flexbox 確保內容居中 */
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            transform: translateY(0);
            border: 3px solid;
            will-change: background, color, text-shadow, border-color, box-shadow, transform, clip-path;
            /* 鑽石形狀 */
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            /* 能量光暈動畫 - 基礎效果 */
            animation: energy-halo 2s infinite alternate, tag-float 3s infinite ease-in-out;
            /* 寶石切割面效果 */
            background-image: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%, rgba(0,0,0,0.2) 100%);
        }

        @keyframes energy-halo {
            0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.3); }
            100% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.7); }
        }
        
        /* 抽卡動畫 - 揭示 (通用) */
        @keyframes flip-in {
            0% { transform: perspective(800px) rotateY(-90deg) scale(0.8); opacity: 0; }
            70% { transform: perspective(800px) rotateY(10deg) scale(1.05); opacity: 1; }
            100% { transform: perspective(800px) rotateY(0deg) scale(1); opacity: 1; }
        }

        /* 通用卡片脈衝/呼吸動畫 */
        @keyframes card-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.01); }
            100% { transform: scale(1); }
        }
        /* 標籤輕微浮動動畫 */
        @keyframes tag-float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        /* --- R 等級 (藍色主題，基礎閃光效果) --- */
        .rarity-tag.r {
            background: linear-gradient(45deg, #ADD8E6 0%, #87CEEB 50%, #B0E0E6 100%); /* 淺藍漸變 */
            color: #333;
            text-shadow: 1px 1px 4px rgba(255,255,255,0.7);
            border-color: #E0FFFF; /* 淺藍邊框 */
        }
        .card-reveal.r .card-image {
            animation: flip-in 0.6s ease-out forwards, r-flash 1.5s infinite alternate 0.6s;
        }
        @keyframes r-flash {
            0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 4px 20px rgba(135,206,235,0.6), 0 0 10px rgba(135,206,235,0.4); } /* 淺藍色閃光 */
        }

        /* --- SR 等級 (紫色主題，星星裝飾 + 閃光) --- */
        .rarity-tag.sr {
            background: linear-gradient(45deg, #8A2BE2 0%, #BA55D3 50%, #DA70D6 100%); /* 紫羅蘭到蘭花紫漸變 */
            color: white;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
            border-color: #D8BFD8; /* 淺紫邊框 */
        }
        .card-reveal.sr .card-image {
            animation: flip-in 0.6s ease-out forwards, sr-glow 1.5s infinite alternate 0.6s;
            position: relative;
            overflow: hidden;
        }
        @keyframes sr-glow {
            0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 4px 25px rgba(138,43,226,0.7), 0 0 15px rgba(138,43,226,0.5); } /* 紫色光暈 */
        }
        /* 星星裝飾 */
        .card-reveal.sr .card-image::before,
        .card-reveal.sr .card-image::after {
            content: '✨'; /* 星星符號 */
            position: absolute;
            font-size: 1.5rem;
            opacity: 0;
            animation: sr-star-twinkle 2s infinite ease-out 0.8s; /* 延遲出現 */
            pointer-events: none;
        }
        .card-reveal.sr .card-image::before {
            top: 10%; left: 15%;
            animation-delay: 0.9s;
        }
        .card-reveal.sr .card-image::after {
            bottom: 15%; right: 20%;
            animation-delay: 1.2s;
            font-size: 1.2rem;
        }
        @keyframes sr-star-twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); }
        }


        /* --- SSR 等級 (金色主題，強烈光效 + 星星閃爍) --- */
        .rarity-tag.ssr {
            background: linear-gradient(45deg, #FFD700 0%, #FFA500 60%, #FFCC00 100%); /* 金橙漸變 */
            color: #8B4513;
            text-shadow: 1px 1px 4px rgba(255,255,255,0.8);
            border-color: #FFECB3; /* 淺金邊框 */
        }
        @keyframes ssr-tag-glow {
            0%, 100% { box-shadow: 0 6px 15px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 6px 20px rgba(255,215,0,0.8), 0 0 15px rgba(255,215,0,0.5); }
        }
        .card-reveal.ssr .card-image {
            animation: flip-in 0.6s ease-out forwards, ssr-card-glow 1.5s infinite alternate 0.6s;
            position: relative;
            overflow: hidden;
        }
        @keyframes ssr-card-glow {
            0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 4px 25px rgba(255,215,0,0.8), 0 0 20px rgba(255,215,0,0.7); } /* 金色強烈光暈 */
        }
        /* 星星閃爍 */
        .card-reveal.ssr .card-image::before,
        .card-reveal.ssr .card-image::after {
            content: '';
            position: absolute;
            background: radial-gradient(circle at center, #FFF 0%, transparent 70%);
            animation: ssr-star-burst 1.5s infinite ease-out 0.8s;
            pointer-events: none;
        }
        .card-reveal.ssr .card-image::before {
            width: 30px; height: 30px;
            top: 20%; left: 70%;
            animation-delay: 0.9s;
        }
        .card-reveal.ssr .card-image::after {
            width: 20px; height: 20px;
            bottom: 10%; left: 30%;
            animation-delay: 1.2s;
        }
        @keyframes ssr-star-burst {
            0% { transform: scale(0); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }


        /* --- SSS 等級 (彩虹主題，動態漸變 + 鑽石特效) --- */
        .rarity-tag.sss {
            background: linear-gradient(45deg, #FF0000, #FF7F00, #FFFF00, #00FF00, #0000FF, #4B0082, #9400D3); /* 彩虹漸變 */
            background-size: 400% 400%; /* 為了動態漸變 */
            color: white;
            text-shadow: 0 0 8px #fff, 0 0 12px #00BFFF, 0 0 15px #1E90FF;
            border-color: #E0FFFF;
            animation: pulse-glow 1.5s infinite alternate, sss-rainbow-bg 10s infinite linear;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.7); /* 強烈內外發光 */
        }
        @keyframes sss-rainbow-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 20px rgba(0, 255, 255, 0.3), inset 0 0 5px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.7); }
            100% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 20px rgba(0, 255, 255, 0.3), inset 0 0 5px rgba(255, 255, 255, 0.5); }
        }

        .card-reveal.sss .card-image {
            animation: flip-in 0.6s ease-out forwards, sss-pulse-scale 2s infinite alternate 0.6s, sss-border-rainbow 5s infinite linear 0.6s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4); /* 基礎陰影 */
        }
        @keyframes sss-pulse-scale {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        @keyframes sss-border-rainbow {
            0% { border-color: #FF0000; box-shadow: 0 4px 20px rgba(255,0,0,0.7); }
            16% { border-color: #FF7F00; box-shadow: 0 4px 20px rgba(255,127,0,0.7); }
            33% { border-color: #FFFF00; box-shadow: 0 4px 20px rgba(255,255,0,0.7); }
            50% { border-color: #00FF00; box-shadow: 0 4px 20px rgba(0,255,0,0.7); }
            66% { border-color: #0000FF; box-shadow: 0 4px 20px rgba(0,0,255,0.7); }
            83% { border-color: #4B0082; box-shadow: 0 4px 20px rgba(75,0,130,0.7); }
            100% { border-color: #9400D3; box-shadow: 0 4px 20px rgba(148,0,211,0.7); }
        }
        /* SSS 卡片內部的鑽石閃爍效果 */
        .card-reveal.sss .card-image::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255,255,255,0.8) 0%, transparent 10%),
                radial-gradient(circle at 80% 30%, rgba(255,255,255,0.8) 0%, transparent 10%),
                radial-gradient(circle at 50% 70%, rgba(255,255,255,0.8) 0%, transparent 10%);
            background-size: 200% 200%;
            animation: sss-diamond-sparkle 1.5s infinite alternate;
            pointer-events: none;
            mix-blend-mode: screen; /* 讓光效疊加更自然 */
        }
        @keyframes sss-diamond-sparkle {
            0% { transform: scale(0.5) rotate(0deg); opacity: 0.5; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(0.5) rotate(360deg); opacity: 0.5; }
        }


        /* --- 抽卡中動畫 (卡背設計) --- */
        @keyframes card-shuffling {
            0% { transform: perspective(600px) rotateY(0deg); }
            50% { transform: perspective(600px) rotateY(180deg); }
            100% { transform: perspective(600px) rotateY(360deg); }
        }
        @keyframes card-back-shine {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes border-shimmer {
            0% { border-image-source: linear-gradient(45deg, #FFD700, #FF69B4, #4169E1); }
            25% { border-image-source: linear-gradient(45deg, #FF69B4, #4169E1, #FFD700); }
            50% { border-image-source: linear-gradient(45deg, #4169E1, #FFD700, #FF69B4); }
            75% { border-image-source: linear-gradient(45deg, #FF69B4, #4169E1, #FFD700); }
            100% { border-image-source: linear-gradient(45deg, #FFD700, #FF69B4, #4169E1); }
        }
        @keyframes pulse-glow-symbol {
            0% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
        }

        .card-shuffling {
            width: 100%;
            max-width: 320px;
            height: 320px;
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            border: 5px solid;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #4b0082, #8a2be2); /* 紫色漸變底色 */
            animation: card-shuffling 1.5s infinite linear;
            border-image: linear-gradient(45deg, #FFD700, #FF69B4, #4169E1) 1; /* 漸變邊框 */
            animation: card-shuffling 1.5s infinite linear, border-shimmer 2s infinite linear;
            will-change: transform, background, border-image, box-shadow;
        }

        .card-shuffling::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,.3), transparent); /* 閃爍流光 */
            background-size: 200% 100%;
            animation: card-back-shine 2s infinite linear;
            pointer-events: none;
            will-change: background-position;
        }
        .card-shuffling::after {
            content: '✨'; /* 替換為更抽象的符號 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotateY(0deg);
            font-size: 5rem;
            color: rgba(255, 255, 255, 0.7);
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
            animation: pulse-glow-symbol 2s infinite alternate;
            will-change: transform, opacity, text-shadow;
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const BirthdayGameApp = () => {
            const [currentPoints, setCurrentPoints] = useState(0);
            const [currentPage, setCurrentPage] = useState('home');
            const [gameResults, setGameResults] = useState({});
            const [gameState, setGameState] = useState('ready');
            const [drawResult, setDrawResult] = useState(null);
            const [recentDrawnCards, setRecentDrawnCards] = useState([]);
            const RECENT_DRAWN_LIMIT = 3;

            console.log('渲染狀態:', gameState, '點數:', currentPoints);

            const games = [
                { id: 'guess-number', name: '1A2B猜數字', points: 3, difficulty: '簡單', emoji: '🔢' },
                { id: 'memory-card', name: '翻牌連連看', points: 3, difficulty: '中等', emoji: '🎴' },
                { id: 'whack-a-mole', name: '打地鼠', points: 4, difficulty: '中等', emoji: '🐭' },
                { id: 'candy-crush', name: '糖果消消樂', points: 5, difficulty: '簡單', emoji: '🍭' },
            ];
            const completeGame = (gameId, points) => {
                setCurrentPoints(prev => prev + points);
                setGameResults(prev => ({
                    ...prev,
                    [gameId]: (prev[gameId] || 0) + 1
                }));
            };

            const cardImages = {
                sss: [
                    'https://github.com/Avis0930/my-surprise-game/blob/main/images/sss.jpg?raw=true', // SSS 圖片名稱修正
                ],
                ssr: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/ssr2.jpg',
                    'https://github.com/Avis0930/my-surprise-game/blob/main/images/ssr3.jpg?raw=true',
                    'https://github.com/Avis0930/my-surprise-game/blob/main/images/ssr4.jpg?raw=true'
                ],
                sr: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr5.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr6.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr7.jpg?raw=true',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr8.jpg?raw=true',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr9.jpg?raw=true',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/sr10.jpg?raw=true'
                ],
                r: [
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r1.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r2.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r3.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r4.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r5.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r6.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r7.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r8.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r9.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r10.jpg',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r11.jpg?raw=true',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r12.jpg?raw=true',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r13.jpg?raw=true',
                    'https://raw.githubusercontent.com/Avis0930/my-surprise-game/main/images/r14.jpg?raw=true',
                    'https://github.com/Avis0930/my-surprise-game/blob/main/images/r15.jpg?raw=true',
                    'https://github.com/Avis0930/my-surprise-game/blob/main/images/r16.jpg?raw=true',
                    'https://github.com/Avis0930/my-surprise-game/blob/main/images/r17.jpg?raw=true'
                ]
            };

            const actualCardImages = cardImages;

            useEffect(() => {
                console.log('開始預載入圖片...');
                Object.values(actualCardImages).forEach(imageArray => {
                    imageArray.forEach(url => {
                        const img = new Image();
                        img.src = url;
                        img.onload = () => console.log(`圖片載入完成: ${url}`);
                        img.onerror = () => console.error(`圖片載入失敗: ${url}`);
                    });
                });
            }, []);

            // 打地鼠遊戲組件
            const WhackAMoleGame = () => {
                const [score, setScore] = useState(0);
                const [timeLeft, setTimeLeft] = useState(30);
                const [activeHole, setActiveHole] = useState(null);
                const [gameOver, setGameOver] = useState(false);
                const [gameStarted, setGameStarted] = useState(false);
                const timerRef = useRef(null);
                const moleTimerRef = useRef(null);

                const moles = Array.from({ length: 9 }, (_, i) => i);

                const startGame = () => {
                    setScore(0);
                    setTimeLeft(30);
                    setActiveHole(null);
                    setGameOver(false);
                    setGameStarted(true);
                    startTimer();
                    showMole();
                };

                const startTimer = () => {
                    timerRef.current = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                clearInterval(timerRef.current);
                                clearInterval(moleTimerRef.current);
                                setGameOver(true);
                                setActiveHole(null);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                };

                const showMole = () => {
                    const randomDelay = Math.random() * (1.2 - 0.8) + 0.8;
                    moleTimerRef.current = setTimeout(() => {
                        let newHole = Math.floor(Math.random() * moles.length);
                        while (newHole === activeHole) {
                            newHole = Math.floor(Math.random() * moles.length);
                        }
                        setActiveHole(newHole);

                        const disappearDelay = Math.random() * (2.5 - 1.5) + 1.5;
                        setTimeout(() => {
                            if (activeHole === newHole) {
                                setActiveHole(null);
                            }
                            if (!gameOver) {
                                showMole();
                            }
                        }, disappearDelay * 1000);
                    }, randomDelay * 1000);
                };

                const whackMole = (holeIndex) => {
                    if (gameOver || activeHole !== holeIndex) {
                        return;
                    }
                    setScore(prevScore => prevScore + 1);
                    setActiveHole(null);
                    
                    if (!gameOver) {
                        clearTimeout(moleTimerRef.current);
                        showMole();
                    }
                };

                useEffect(() => {
                    return () => {
                        clearInterval(timerRef.current);
                        clearTimeout(moleTimerRef.current);
                    };
                }, []);

                useEffect(() => {
                    if (gameOver) {
                        if (score >= 15) {
                            completeGame('whack-a-mole', 4);
                            setCurrentPage('success-whack-a-mole');
                        }
                    }
                }, [gameOver, score, completeGame, setCurrentPage]);

                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-300 via-lime-400 to-emerald-500 p-4 no-zoom flex items-center justify-center">
                        <div className="max-w-md mx-auto text-center w-full">
                            <div className="bg-white/95 backdrop-blur-sm border-4 border-green-500 shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
                                <h2 className="text-center font-black text-xl text-green-700 mb-2">🔨 打地鼠遊戲</h2>
                                <p className="text-center text-sm text-gray-600 font-semibold mb-4">
                                    擊中地鼠獲得分數，時間內達到15分即可過關！
                                </p>
                                <div className="flex justify-between items-center mb-4 bg-lime-100 rounded-full px-4 py-2 border-2 border-lime-200">
                                    <div className="text-lg font-bold text-green-700">分數: {score}</div>
                                    <div className={`text-xl font-bold ${timeLeft <= 10 && !gameOver ? 'text-red-500 animate-pulse' : 'text-green-700'}`}>
                                        時間: {formatTime(timeLeft)}
                                    </div>
                                </div>

                                {!gameStarted && !gameOver ? (
                                    <button
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-green-500 to-green-700 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                    >
                                        🚀 開始遊戲
                                    </button>
                                ) : gameOver ? (
                                    <div className="space-y-4">
                                        <div className="text-4xl font-black text-green-700">
                                            {score >= 15 ? '🎉 恭喜過關！' : '😅 時間結束！'}
                                        </div>
                                        <div className="text-xl font-bold text-gray-700 bg-gray-100 rounded-full px-4 py-2">
                                            最終分數: {score}
                                        </div>
                                        {score < 15 && (
                                            <div className="text-lg font-bold text-red-600 bg-red-100 rounded-full px-4 py-2">
                                                未達到 {15} 分，沒有獲得獎勵哦！
                                            </div>
                                        )}
                                        <button
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                        >
                                            🔄 再玩一次
                                        </button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-3 gap-3 bg-gradient-to-br from-yellow-700 to-orange-800 p-4 rounded-xl border-4 border-yellow-600 shadow-inner">
                                        {moles.map((holeIndex) => (
                                            <div
                                                key={holeIndex}
                                                className="relative w-full aspect-square bg-gradient-to-br from-yellow-900 to-yellow-700 rounded-full flex items-center justify-center overflow-hidden"
                                                style={{ boxShadow: 'inset 0 0 10px rgba(0,0,0,0.5)' }}
                                                onClick={() => whackMole(holeIndex)}
                                            >
                                                {activeHole === holeIndex ? (
                                                    <span className="absolute inset-0 flex items-center justify-center text-6xl cursor-pointer select-none mole-active">
                                                            🐹
                                                    </span>
                                                ) : (
                                                    <span className="text-4xl text-yellow-600 select-none">🕳️</span>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                            >
                                🏠 回到首頁
                            </button>
                        </div>
                    </div>
                );
            };

            // 糖果消消樂遊戲組件
            const CandyCrushGame = () => {
                const candies = ['🍭', '🍬', '🍫', '🧁', '🍩'];
                const rows = 6;
                const cols = 6;
                const targetScore = 500;

                const [grid, setGrid] = useState([]);
                const [score, setScore] = useState(0);
                const [timeLeft, setTimeLeft] = useState(30);
                const [gameOver, setGameOver] = useState(false);
                const [gameStarted, setGameStarted] = useState(false);
                const [selectedCandy, setSelectedCandy] = useState(null);
                const gameIntervalRef = useRef(null);

                const generateInitialGrid = () => {
                    const newGrid = Array(rows).fill(null).map(() => Array(cols).fill(null));
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c < cols; c++) {
                            newGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'normal' };
                        }
                    }
                    let hasMatch = true;
                    while (hasMatch) {
                        hasMatch = false;
                        const matches = checkMatches(newGrid);
                        if (matches.length > 0) {
                            hasMatch = true;
                            matches.forEach(({ r, c }) => {
                                newGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'normal' };
                            });
                        }
                    }
                    return newGrid;
                };

                const checkMatches = (currentGrid) => {
                    const matches = new Set();
                
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c <= cols - 3; c++) {
                            const candy = currentGrid[r][c].emoji;
                            if (candy && candy === currentGrid[r][c + 1].emoji && candy === currentGrid[r][c + 2].emoji) {
                                let lineLength = 3;
                                while (c + lineLength < cols && candy === currentGrid[r][c + lineLength].emoji) {
                                    lineLength++;
                                }
                                for (let i = 0; i < lineLength; i++) {
                                    matches.add(`${r}-${c + i}`);
                                }
                            }
                        }
                    }
                
                    for (let c = 0; c < cols; c++) {
                        for (let r = 0; r <= rows - 3; r++) {
                            const candy = currentGrid[r][c].emoji;
                            if (candy && candy === currentGrid[r + 1][c].emoji && candy === currentGrid[r + 2][c].emoji) {
                                let lineLength = 3;
                                while (r + lineLength < rows && candy === currentGrid[r + lineLength][c].emoji) {
                                    lineLength++;
                                }
                                for (let i = 0; i < lineLength; i++) {
                                    matches.add(`${r + i}-${c}`);
                                }
                            }
                        }
                    }
                    return Array.from(matches).map(pos => {
                        const [r, c] = pos.split('-').map(Number);
                        return { r, c };
                    });
                };
                
                const processMatches = async (initialGrid) => {
                    let currentGrid = JSON.parse(JSON.stringify(initialGrid));
                    let totalScoreFromThisMove = 0;

                    while (true) {
                        const matches = checkMatches(currentGrid);
                        if (matches.length === 0) {
                            break;
                        }

                        const matchedGroups = groupMatches(matches);
                        matchedGroups.forEach(group => {
                            const length = group.length;
                            if (length === 3) totalScoreFromThisMove += 30;
                            else if (length === 4) totalScoreFromThisMove += 60;
                            else if (length >= 5) totalScoreFromThisMove += 100;
                        });

                        matches.forEach(({ r, c }) => {
                            currentGrid[r][c].status = 'clearing';
                        });
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid)));
                            resolve();
                        }));

                        await new Promise(resolve => setTimeout(resolve, 200));

                        matches.forEach(({ r, c }) => {
                            currentGrid[r][c] = { emoji: null, status: 'cleared' };
                        });

                        for (let c = 0; c < cols; c++) {
                            let writeRow = rows - 1;
                            for (let r = rows - 1; r >= 0; r--) {
                                if (currentGrid[r][c].emoji !== null) {
                                    currentGrid[writeRow][c] = currentGrid[r][c];
                                    writeRow--;
                                }
                            }
                            for (let r = writeRow; r >= 0; r--) {
                                currentGrid[r][c] = { emoji: candies[Math.floor(Math.random() * candies.length)], status: 'falling' };
                            }
                        }
                        
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid)));
                            resolve();
                        }));

                        await new Promise(resolve => setTimeout(resolve, 200));

                        for (let r = 0; r < rows; r++) {
                            for (let c = 0; c < cols; c++) {
                                currentGrid[r][c].status = 'normal';
                            }
                        }
                        await new Promise(resolve => requestAnimationFrame(() => {
                            setGrid(JSON.parse(JSON.stringify(currentGrid)));
                            resolve();
                        }));
                    }
                    setScore(s => s + totalScoreFromThisMove);
                };

                const groupMatches = (matches) => {
                    const visited = new Set();
                    const groups = [];

                    matches.forEach(match => {
                        const { r, c } = match;
                        if (!visited.has(`${r}-${c}`)) {
                            const currentGroup = [];
                            const queue = [{ r, c }];
                            visited.add(`${r}-${c}`);
                            
                            while (queue.length > 0) {
                                const { r: currR, c: currC } = queue.shift();
                                currentGroup.push({ r: currR, c: currC });

                                const directions = [
                                    [-1, 0], [1, 0], [0, -1], [0, 1]
                                ];

                                for (const [dr, dc] of directions) {
                                    const newR = currR + dr;
                                    const newC = currC + dc;

                                    if (
                                        matches.some(m => m.r === newR && m.c === newC) &&
                                        !visited.has(`${newR}-${newC}`)
                                    ) {
                                        visited.add(`${newR}-${newC}`);
                                        queue.push({ r: newR, c: newC });
                                    }
                                }
                            }
                            groups.push(currentGroup);
                        }
                    });
                    return groups;
                };

                const startGame = () => {
                    setScore(0);
                    setTimeLeft(30);
                    setGameOver(false);
                    setGameStarted(true);
                    setSelectedCandy(null);
                    const initialGrid = generateInitialGrid();
                    setGrid(initialGrid);

                    clearInterval(gameIntervalRef.current);
                    gameIntervalRef.current = setInterval(() => {
                        setTimeLeft(prevTime => {
                            if (prevTime <= 1) {
                                clearInterval(gameIntervalRef.current);
                                setGameOver(true);
                                return 0;
                            }
                            return prevTime - 1;
                        });
                    }, 1000);
                };

                useEffect(() => {
                    if (gameOver) {
                        clearInterval(gameIntervalRef.current);
                        if (score >= targetScore) {
                            completeGame('candy-crush', 5);
                            setCurrentPage('success-candy-crush');
                        }
                    }
                }, [gameOver, score, targetScore, completeGame, setCurrentPage]);

                useEffect(() => {
                    return () => clearInterval(gameIntervalRef.current);
                }, []);

                const handleCandyClick = async (r, c) => {
                    if (gameOver || !gameStarted) return;

                    if (selectedCandy) {
                        const prevR = selectedCandy.r;
                        const prevC = selectedCandy.c;

                        const isAdjacent = (
                            (Math.abs(r - prevR) === 1 && c === prevC) ||
                            (Math.abs(c - prevC) === 1 && r === prevR)
                        );

                        if (isAdjacent) {
                            const newGrid = JSON.parse(JSON.stringify(grid));
                            [newGrid[r][c].emoji, newGrid[prevR][prevC].emoji] = [newGrid[prevR][prevC].emoji, newGrid[r][c].emoji];
                            
                            await new Promise(resolve => requestAnimationFrame(() => {
                                setGrid(newGrid);
                                resolve();
                            }));
                            
                            const hasMatch = checkMatches(newGrid).length > 0;
                            if (hasMatch) {
                                await processMatches(newGrid);
                            } else {
                                await new Promise(resolve => setTimeout(resolve, 200));
                                [newGrid[r][c].emoji, newGrid[prevR][prevC].emoji] = [newGrid[prevR][prevC].emoji, newGrid[r][c].emoji];
                                await new Promise(resolve => requestAnimationFrame(() => {
                                    setGrid(newGrid);
                                }));
                            }
                        }
                        setSelectedCandy(null);
                    } else {
                        setSelectedCandy({ r, c });
                    }
                };

                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-300 via-orange-400 to-yellow-500 p-4 no-zoom flex items-center justify-center">
                        <div className="max-w-md mx-auto text-center w-full">
                            <div className="bg-white/95 backdrop-blur-sm border-4 border-orange-500 shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
                                <h2 className="text-center font-black text-xl text-orange-700 mb-2">🍬 糖果消消樂</h2>
                                <p className="text-center text-sm text-gray-600 font-semibold mb-4">
                                    交換糖果，達成3個以上連線消除！目標分數 {targetScore}！
                                </p>
                                <div className="flex justify-between items-center mb-4 bg-yellow-100 rounded-full px-4 py-2 border-2 border-yellow-200">
                                    <div className="text-lg font-bold text-orange-700">分數: {score}</div>
                                    <div className={`text-xl font-bold ${timeLeft <= 10 && !gameOver ? 'text-red-500 animate-pulse' : 'text-orange-700'}`}>
                                        時間: {formatTime(timeLeft)}
                                    </div>
                                </div>

                                {!gameStarted && !gameOver ? (
                                    <button
                                        onClick={startGame}
                                        className="w-full bg-gradient-to-r from-orange-500 to-orange-700 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                    >
                                        🚀 開始遊戲
                                    </button>
                                ) : gameOver ? (
                                    <div className="space-y-4">
                                        <div className="text-4xl font-black text-orange-700">
                                            {score >= targetScore ? '🎉 恭喜過關！' : '😅 時間結束！'}
                                        </div>
                                        <div className="text-xl font-bold text-gray-700 bg-gray-100 rounded-full px-4 py-2">
                                            最終分數: {score}
                                        </div>
                                        {score < targetScore && (
                                            <div className="text-lg font-bold text-red-600 bg-red-100 rounded-full px-4 py-2">
                                                未達到 {targetScore} 分，沒有獲得獎勵哦！
                                            </div>
                                        )}
                                        <button
                                            onClick={startGame}
                                            className="w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                        >
                                            🔄 再玩一次
                                        </button>
                                    </div>
                                ) : (
                                    <div className="candy-grid">
                                        {grid.map((row, rIdx) =>
                                            row.map((candyData, cIdx) => (
                                                <div
                                                    key={`${rIdx}-${cIdx}`}
                                                    className={`candy-tile ${selectedCandy?.r === rIdx && selectedCandy?.c === cIdx ? 'selected' : ''} ${candyData.status === 'clearing' ? 'clearing' : ''} ${candyData.status === 'falling' ? 'falling' : ''}`}
                                                    onClick={() => handleCandyClick(rIdx, cIdx)}
                                                >
                                                    <span className="candy-content">{candyData.emoji}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                            >
                                🏠 回到首頁
                            </button>
                        </div>
                    </div>
                );
            };

            // 抽卡機制
            const addPoints = () => {
                setCurrentPoints(p => p + 10);
                setGameState('ready');
                console.log('+10點，重置為ready');
            };

            const drawCard = () => {
                if (currentPoints < 5 || gameState !== 'ready') return;
                setCurrentPoints(p => p - 5);
                setGameState('drawing');
                console.log('開始抽卡，狀態->drawing');
                
                setTimeout(() => {
                    const rarityRoll = Math.random();
                    let chosenCardUrl = null;
                    let chosenType = '';
                    let availableCards = [];

                    // SSS: 1% (0.0 - 0.01)
                    // SSR: 19% (0.01 - 0.20)
                    // SR: 30% (0.20 - 0.50)
                    // R: 50% (0.50 - 1.00)

                    if (rarityRoll < 0.01) {
                        chosenType = 'sss';
                        availableCards = actualCardImages.sss;
                    } else if (rarityRoll < 0.2) {
                        chosenType = 'ssr';
                        availableCards = actualCardImages.ssr;
                    } else if (rarityRoll < 0.5) {
                        chosenType = 'sr';
                        availableCards = actualCardImages.sr;
                    } else {
                        chosenType = 'r';
                        availableCards = actualCardImages.r;
                    }

                    const filteredCards = availableCards.filter(url => !recentDrawnCards.includes(url));

                    if (filteredCards.length > 0) {
                        chosenCardUrl = filteredCards[Math.floor(Math.random() * filteredCards.length)];
                    } else {
                        chosenCardUrl = availableCards[Math.floor(Math.random() * availableCards.length)];
                        setRecentDrawnCards([]);
                        console.log('所有卡片已抽取過一輪，重置近期抽卡列表。');
                    }

                    setRecentDrawnCards(prev => {
                        const newRecent = [...prev, chosenCardUrl];
                        if (newRecent.length > RECENT_DRAWN_LIMIT) {
                            return newRecent.slice(1);
                        }
                        return newRecent;
                    });
                    
                    setDrawResult({ type: chosenType, url: chosenCardUrl });
                    setGameState('result');
                    console.log('計時器執行，狀態->result');
                }, 1000);
            };

            const resetGame = () => {
                setGameState('ready');
                console.log('重置，狀態->ready');
                setDrawResult(null);
            };

            // 首頁
            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-cyan-300 via-purple-400 to-pink-400 p-4 no-zoom">
                    <div className="max-w-sm mx-auto">
                        <div className="text-center mb-6">
                            <div className="bg-white/90 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-4 border-white">
                                <h1 className="text-2xl sm:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 to-pink-500 mb-2">
                                    Special GAME
                                </h1>
                                <p className="text-purple-700 font-semibold text-sm">完成遊戲獲得點數，集滿5點抽驚喜卡片！</p>
                                <div className="flex justify-center space-x-2 mt-3">
                                    <span className="text-2xl">💖</span>
                                    <span className="text-2xl">🌈</span>
                                    <span className="text-2xl">✨</span>
                                </div>
                            </div>
                        </div>

                        <div className="fixed top-4 left-4 space-y-2">
                            <button onClick={addPoints} className="bg-red-600 text-white px-4 py-2 rounded font-bold">
                                +10點
                            </button>
                            <button onClick={resetGame} className="bg-gray-600 text-white px-4 py-2 rounded font-bold">
                                重置
                            </button>
                        </div>

                        <div className="mb-6 bg-gradient-to-r from-yellow-300 to-orange-300 border-4 border-white shadow-xl rounded-2xl p-6 text-center">
                            <div className="text-2xl font-black text-white mb-2 drop-shadow-lg">
                                ⭐ 點數: {currentPoints} ⭐
                            </div>
                            <div className="text-base font-bold text-purple-800 bg-white/80 rounded-full px-4 py-1">
                                {Math.floor(currentPoints / 5)} 次抽卡機會 🎴
                            </div>
                        </div>

                        <div className="bg-gradient-to-r from-yellow-300 via-pink-300 to-purple-300 border-4 border-white rounded-2xl p-6 mb-6">
                            <h3 className="font-black text-xl mb-4 text-white text-center">✨ 您的卡片 ✨</h3>
                            
                            <div className="text-center">
                                {gameState === 'ready' && (
                                    <div>
                                        {currentPoints >= 5 ? (
                                            <button
                                                onClick={drawCard}
                                                className="w-full bg-cyan-500 text-white px-6 py-4 rounded-full text-lg font-black hover:bg-cyan-600"
                                            >
                                                🎴 抽卡片！(-5點) ✨
                                            </button>
                                        ) : (
                                            <div className="bg-white/90 rounded-full px-4 py-3">
                                                <p className="text-purple-700 font-bold">還需要 {5 - currentPoints} 點才能抽卡 ✨</p>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {gameState === 'drawing' && (
                                    <div className="flex flex-col items-center justify-center space-y-4">
                                        <div className="card-shuffling">
                                        </div>
                                        <div className="text-white font-bold text-xl animate-pulse">抽卡中...</div>
                                    </div>
                                )}

                                {gameState === 'result' && drawResult && (
                                    <div className={`flex flex-col items-center justify-center space-y-4 card-reveal ${drawResult.type}`}>
                                        {drawResult.url && (
                                            <img
                                                src={drawResult.url}
                                                alt={drawResult.type}
                                                className={`card-image ${drawResult.type}`}
                                            />
                                        )}
                                        <div className={`rarity-tag ${drawResult.type}`}>
                                            {drawResult.type.toUpperCase()}
                                        </div>
                                        
                                        <button
                                            onClick={resetGame}
                                            className="w-full bg-purple-500 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-600"
                                        >
                                            繼續遊戲 💫
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="space-y-4">
                            {games.map((game, index) => {
                                const gradients = [
                                    'from-pink-400 to-rose-400',
                                    'from-cyan-400 to-blue-400',
                                    'from-purple-400 to-violet-400',
                                    'from-green-400 to-emerald-400'
                                ];
                                return (
                                    <div key={game.id} className={`bg-gradient-to-r ${gradients[index % gradients.length]} border-4 border-white shadow-xl rounded-2xl`}>
                                        <div className="p-4">
                                            <div className="flex justify-between items-center">
                                                <div className="flex-1">
                                                    <h3 className="font-black text-lg text-white drop-shadow-lg">
                                                        {game.emoji} {game.name}
                                                    </h3>
                                                    <p className="text-sm text-white/90 font-semibold">
                                                        {game.difficulty} | {game.points}點 ⭐
                                                    </p>
                                                    {gameResults[game.id] && (
                                                        <p className="text-sm text-yellow-200 font-bold">
                                                            🎉 完成 {gameResults[game.id]} 次
                                                        </p>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => setCurrentPage(game.id)}
                                                    className="mobile-button bg-white text-purple-700 px-4 py-2 rounded-full font-black hover:bg-yellow-300 transition-all shadow-lg text-sm"
                                                >
                                                    START! 💫
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
            // 猜數字遊戲
            const GuessNumberGame = () => {
                const [targetNumber, setTargetNumber] = useState('');
                const [guess, setGuess] = useState('');
                const [history, setHistory] = useState([]);
                const [attempts, setAttempts] = useState(0);
                const [gameOver, setGameOver] = useState(false);
                
                useEffect(() => {
                    resetNumberGame();
                }, []);
                
                const generateNewTargetNumber = () => {
                    const digits = [];
                    while (digits.length < 3) {
                        const digit = Math.floor(Math.random() * 10).toString();
                        if (!digits.includes(digit)) {
                            digits.push(digit);
                        }
                    }
                    return digits.join('');
                };

                const checkGuess = () => {
                    if (guess.length !== 3 || new Set(guess.split('')).size !== 3) {
                        alert('請輸入3位不重複數字！');
                        return;
                    }

                    let a = 0, b = 0;
                    for (let i = 0; i < 3; i++) {
                        if (guess[i] === targetNumber[i]) {
                            a++;
                        } else if (targetNumber.includes(guess[i])) {
                            b++;
                        }
                    }

                    const result = `${guess} - ${a}A${b}B`;
                    setHistory([result, ...history]);
                    setAttempts(attempts + 1);

                    if (a === 3) {
                        setGameOver(true);
                        completeGame('guess-number', 3);
                        setCurrentPage('success-number');
                    } else if (attempts + 1 >= 10) {
                        setGameOver(true);
                    }

                    setGuess('');
                };

                const resetNumberGame = () => {
                    setGameOver(false);
                    setHistory([]);
                    setGuess('');
                    setAttempts(0);
                    setTargetNumber(generateNewTargetNumber());
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-cyan-400 via-purple-500 to-pink-500 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-blue-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🔢 數字遊戲</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        猜出3位不重複數字！A=位置和數字都對，B=數字對但位置錯 ✨
                                    </p>
                                    <p className="text-center text-xs text-white/80 mt-1">
                                        剩餘機會: {10 - attempts} 次
                                    </p>
                                </div>
                                <div className="p-6">
                                    {!gameOver || (gameOver && attempts < 10) ? (
                                        <div className="space-y-4">
                                            <div className="space-y-3">
                                                <input
                                                    type="tel"
                                                    value={guess}
                                                    onChange={(e) => setGuess(e.target.value.replace(/\D/g, '').slice(0, 3))}
                                                    placeholder="輸入3位數字"
                                                    className="w-full p-4 border-4 border-purple-300 rounded-full text-center text-xl font-bold focus:border-pink-400 focus:outline-none bg-white text-gray-800"
                                                    maxLength={3}
                                                    disabled={gameOver && attempts >= 10}
                                                />
                                                <button
                                                    onClick={checkGuess}
                                                    className="w-full bg-gradient-to-r from-cyan-400 to-blue-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-2 border-white"
                                                    disabled={gameOver && attempts >= 10}
                                                >
                                                    猜測! 💫
                                                </button>
                                            </div>
                                            
                                            <div className="max-h-48 overflow-y-auto space-y-2">
                                                {history.map((result, index) => (
                                                    <div key={index} className="p-3 bg-gradient-to-r from-purple-100 to-pink-100 rounded-full text-center font-bold text-purple-700 border-2 border-purple-200">
                                                        {result}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">😅 遊戲結束</div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                答案是: {targetNumber}
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">❌ 遊戲失敗！未獲得點數</div>
                                            <button
                                                onClick={resetNumberGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                再挑戰一次! 💪
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                回到首頁 🏠
                            </button>
                        </div>
                    </div>
                );
            };

            // 翻牌連連看遊戲
            const MemoryCardGame = () => {
                const [cards, setCards] = useState([]);
                const [flippedCards, setFlippedCards] = useState([]);
                const [matchedCards, setMatchedCards] = useState([]);
                const [gameOver, setGameOver] = useState(false);
                const [timeLeft, setTimeLeft] = useState(60);
                const [timerActive, setTimerActive] = useState(false);

                const emojis = ['💖', '🌈', '✨', '🌟', '💫', '🎉', '🎈', '🦄'];
                
                useEffect(() => {
                    initializeGame();
                }, []);

                useEffect(() => {
                    let interval = null;
                    if (timerActive && timeLeft > 0 && !gameOver) {
                        interval = setInterval(() => {
                            setTimeLeft(timeLeft => {
                                if (timeLeft <= 1) {
                                    setGameOver(true);
                                    setTimerActive(false);
                                    return 0;
                                }
                                return timeLeft - 1;
                            });
                        }, 1000);
                    } else if (timeLeft === 0 && !gameOver) {
                        setGameOver(true);
                        setTimerActive(false);
                    }
                    return () => clearInterval(interval);
                }, [timerActive, timeLeft, gameOver]);
                
                const initializeGame = () => {
                    const gameCards = [...emojis, ...emojis].map((emoji, index) => ({
                        id: index,
                        emoji
                    }));
                    
                    for (let i = gameCards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [gameCards[i], gameCards[j]] = [gameCards[j], gameCards[i]];
                    }
                    
                    setCards(gameCards);
                    setFlippedCards([]);
                    setMatchedCards([]);
                    setGameOver(false);
                    setTimeLeft(60);
                    setTimerActive(true);
                };

                const flipCard = (cardId) => {
                    if (gameOver || flippedCards.length === 2 || flippedCards.includes(cardId) || matchedCards.includes(cardId)) {
                        return;
                    }

                    const newFlipped = [...flippedCards, cardId];
                    setFlippedCards(newFlipped);

                    if (newFlipped.length === 2) {
                        const [first, second] = newFlipped;
                        const firstCard = cards.find(c => c.id === first);
                        const secondCard = cards.find(c => c.id === second);
                        if (firstCard && secondCard && firstCard.emoji === secondCard.emoji) {
                            const newMatched = [...matchedCards, first, second];
                            setMatchedCards(newMatched);
                            
                            if (newMatched.length === cards.length) {
                                completeGame('memory-card', 3);
                                setTimerActive(false);
                                setCurrentPage('success-memory');
                                return;
                            }
                        }

                        setTimeout(() => setFlippedCards([]), 1000);
                    }
                };
                const formatTime = (seconds) => {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                };
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-400 via-purple-500 to-cyan-400 p-4 no-zoom">
                        <div className="max-w-sm mx-auto">
                            <div className="mb-4 bg-white/95 backdrop-blur-sm border-4 border-white shadow-xl rounded-2xl overflow-hidden">
                                <div className="bg-gradient-to-r from-pink-400 to-purple-500 text-white p-4">
                                    <h2 className="text-center font-black text-xl">🎴 記憶遊戲</h2>
                                    <p className="text-center text-sm text-white/90 font-semibold mt-1">
                                        翻開相同的卡片進行配對！✨
                                    </p>
                                    <div className="text-center mt-2">
                                        <span className={`text-lg font-black ${timeLeft <= 10 ? 'text-red-200 animate-pulse' : 'text-white'}`}>
                                            ⏰ {formatTime(timeLeft)}
                                        </span>
                                    </div>
                                </div>
                                <div className="p-6">
                                    {!gameOver && matchedCards.length < cards.length ? (
                                        <div className="grid grid-cols-4 gap-2">
                                            {cards.map((card) => (
                                                <button
                                                    key={card.id}
                                                    onClick={() => flipCard(card.id)}
                                                    className={`aspect-square text-2xl rounded-xl transition-all duration-300 border-2 border-white shadow-lg ${
                                                        flippedCards.includes(card.id) || matchedCards.includes(card.id)
                                                        ? 'bg-gradient-to-r from-yellow-200 to-pink-200 shadow-xl'
                                                            : 'bg-gradient-to-r from-purple-400 to-pink-400 hover:from-purple-500 hover:to-pink-500'
                                                    } ${matchedCards.includes(card.id) ? 'opacity-60' : ''}`}
                                                >
                                                    {flippedCards.includes(card.id) || matchedCards.includes(card.id) ? card.emoji : '💫'}
                                                </button>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center space-y-4">
                                            <div className="text-4xl animate-pulse">
                                                {matchedCards.length === cards.length ? '🎉 恭喜過關！' : '⏰ 時間到了！'}
                                            </div>
                                            <div className="text-lg font-bold text-purple-700 bg-purple-100 rounded-full px-4 py-2">
                                                已配對: {matchedCards.length / 2} / 8 組
                                            </div>
                                            <div className="text-xl font-black text-red-600 bg-red-100 rounded-full px-6 py-3">
                                                {matchedCards.length === cards.length ? '獲得獎勵！' : '❌ 遊戲失敗！未獲得點數'}
                                            </div>
                                            <button
                                                onClick={initializeGame}
                                                className="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white"
                                            >
                                                再挑戰一次! 💪
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <button
                                onClick={() => setCurrentPage('home')}
                                className="w-full bg-gradient-to-r from-gray-400 to-gray-600 text-white py-4 rounded-full font-black shadow-lg border-4 border-white"
                            >
                                回到首頁 🏠
                            </button>
                        </div>
                    </div>
                );
            };

            // 成功頁面組件
            const SuccessPage = ({ title, emoji, points, gameId }) => (
                <div className="min-h-screen bg-gradient-to-br from-green-300 via-emerald-400 to-teal-500 p-4 flex items-center justify-center no-zoom">
                    <div className="max-w-sm mx-auto text-center">
                        <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-8 shadow-2xl border-4 border-white">
                            <div className="text-6xl mb-4 animate-bounce">{emoji}</div>
                            <h2 className="text-3xl font-black text-green-700 mb-4">{title}</h2>
                            <div className="space-y-3 mb-6">
                                <div className="text-xl font-black text-green-600 bg-yellow-200 rounded-full px-6 py-3 animate-pulse">
                                    ✅ 獲得 {points} 點數！⭐
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button
                                    onClick={() => setCurrentPage(gameId)}
                                    className="mobile-button w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    🎮 再玩一次
                                </button>
                                <button
                                    onClick={() => setCurrentPage('home')}
                                    className="mobile-button w-full bg-gradient-to-r from-purple-400 to-pink-400 text-white px-6 py-4 rounded-full font-black shadow-lg border-4 border-white text-lg"
                                >
                                    🏠 回到主畫面
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // 根據當前頁面渲染
            const renderPage = () => {
                switch (currentPage) {
                    case 'guess-number':
                        return <GuessNumberGame />;
                    case 'memory-card':
                        return <MemoryCardGame />;
                    case 'whack-a-mole':
                        return <WhackAMoleGame />;
                    case 'candy-crush':
                        return <CandyCrushGame />;
                    case 'success-number':
                        return <SuccessPage title="恭喜過關！" emoji="🎉" points={3} gameId="guess-number" />;
                    case 'success-memory':
                        return <SuccessPage title="記憶達人！" emoji="🎉" points={3} gameId="memory-card" />;
                    case 'success-whack-a-mole':
                        return <SuccessPage title="地鼠剋星！" emoji="🔨" points={4} gameId="whack-a-mole" />;
                    case 'success-candy-crush':
                        return <SuccessPage title="甜點大師！" emoji="🍬" points={5} gameId="candy-crush" />;
                    default:
                        return <HomePage />;
                }
            };

            return renderPage();
        };

        ReactDOM.render(<BirthdayGameApp />, document.getElementById('root'));
